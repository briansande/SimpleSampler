ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 1


   1              		.cpu cortex-m7
   2              		.eabi_attribute 28, 1
   3              		.eabi_attribute 20, 1
   4              		.eabi_attribute 21, 1
   5              		.eabi_attribute 23, 3
   6              		.eabi_attribute 24, 1
   7              		.eabi_attribute 25, 1
   8              		.eabi_attribute 26, 1
   9              		.eabi_attribute 30, 2
  10              		.eabi_attribute 34, 1
  11              		.eabi_attribute 18, 4
  12              		.file	"SampleLibrary.cpp"
  13              		.text
  14              	.Ltext0:
  15              		.cfi_sections	.debug_frame
  16              		.section	.text._ZN16MemoryDataSource5ftellEv,"axG",%progbits,_ZN16MemoryDataSource5ftellEv,comdat
  17              		.align	1
  18              		.p2align 2,,3
  19              		.weak	_ZN16MemoryDataSource5ftellEv
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv5-d16
  26              	_ZN16MemoryDataSource5ftellEv:
  27              	.LVL0:
  28              	.LFB1435:
  29              		.file 1 "b3ReadWavFile.h"
   1:b3ReadWavFile.h **** #ifndef B3_READ_WAV_FILE_H
   2:b3ReadWavFile.h **** #define B3_READ_WAV_FILE_H
   3:b3ReadWavFile.h **** 
   4:b3ReadWavFile.h **** #include <vector>
   5:b3ReadWavFile.h **** #include <stdio.h>
   6:b3ReadWavFile.h **** #include <string.h>
   7:b3ReadWavFile.h **** #include <assert.h>
   8:b3ReadWavFile.h **** 
   9:b3ReadWavFile.h **** #define B3_SEEK_CUR    11
  10:b3ReadWavFile.h **** #define B3_SEEK_END    12
  11:b3ReadWavFile.h **** #define B3_SEEK_SET    10
  12:b3ReadWavFile.h **** 
  13:b3ReadWavFile.h **** struct b3DataSource
  14:b3ReadWavFile.h **** {
  15:b3ReadWavFile.h **** 	virtual long  ftell() = 0;
  16:b3ReadWavFile.h **** 	
  17:b3ReadWavFile.h **** 	virtual size_t fread(void* _Buffer, size_t _ElementSize, size_t _ElementCount) = 0;
  18:b3ReadWavFile.h **** 
  19:b3ReadWavFile.h **** 	virtual int fseek(long  _Offset, int   _Origin) = 0;
  20:b3ReadWavFile.h **** };
  21:b3ReadWavFile.h **** 
  22:b3ReadWavFile.h **** struct FileDataSource : public b3DataSource
  23:b3ReadWavFile.h **** {
  24:b3ReadWavFile.h **** 	FileDataSource(const char* fileName)
  25:b3ReadWavFile.h **** 	{
  26:b3ReadWavFile.h **** 		m_fd = fopen(fileName, "rb");
  27:b3ReadWavFile.h **** 	}
  28:b3ReadWavFile.h **** 	virtual ~FileDataSource()
  29:b3ReadWavFile.h **** 	{
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 2


  30:b3ReadWavFile.h **** 		if (m_fd)
  31:b3ReadWavFile.h **** 			fclose(m_fd);
  32:b3ReadWavFile.h **** 	}
  33:b3ReadWavFile.h **** 	FILE* m_fd;
  34:b3ReadWavFile.h **** 
  35:b3ReadWavFile.h **** 	virtual long  ftell()
  36:b3ReadWavFile.h **** 	{
  37:b3ReadWavFile.h **** 		return ::ftell(m_fd);
  38:b3ReadWavFile.h **** 	}
  39:b3ReadWavFile.h **** 	virtual size_t fread(void* _Buffer, size_t _ElementSize, size_t _ElementCount)
  40:b3ReadWavFile.h **** 	{
  41:b3ReadWavFile.h **** 		return ::fread(_Buffer, _ElementSize, _ElementCount, m_fd);
  42:b3ReadWavFile.h **** 	}
  43:b3ReadWavFile.h **** 
  44:b3ReadWavFile.h **** 	virtual int fseek(long  _Offset, int   _OriginOrg)
  45:b3ReadWavFile.h **** 	{
  46:b3ReadWavFile.h **** 		int _Origin = 0;
  47:b3ReadWavFile.h **** 		switch (_OriginOrg)
  48:b3ReadWavFile.h **** 		{
  49:b3ReadWavFile.h **** 		case B3_SEEK_CUR:
  50:b3ReadWavFile.h **** 		{
  51:b3ReadWavFile.h **** 			_Origin = SEEK_CUR;
  52:b3ReadWavFile.h **** 			break;
  53:b3ReadWavFile.h **** 		}
  54:b3ReadWavFile.h **** 		case B3_SEEK_SET:
  55:b3ReadWavFile.h **** 		{
  56:b3ReadWavFile.h **** 			_Origin = SEEK_SET;
  57:b3ReadWavFile.h **** 			break;
  58:b3ReadWavFile.h **** 		}
  59:b3ReadWavFile.h **** 		default:
  60:b3ReadWavFile.h **** 		{
  61:b3ReadWavFile.h **** 		}
  62:b3ReadWavFile.h **** 		}
  63:b3ReadWavFile.h **** 		return ::fseek(m_fd, _Offset, _Origin);
  64:b3ReadWavFile.h **** 	}
  65:b3ReadWavFile.h **** };
  66:b3ReadWavFile.h **** 
  67:b3ReadWavFile.h **** struct MemoryDataSource : public b3DataSource
  68:b3ReadWavFile.h **** {
  69:b3ReadWavFile.h **** 
  70:b3ReadWavFile.h ****   MemoryDataSource()
  71:b3ReadWavFile.h ****   :m_data(),
  72:b3ReadWavFile.h ****   m_numBytes(0),
  73:b3ReadWavFile.h **** 	m_currentAddress(0)
  74:b3ReadWavFile.h ****   {
  75:b3ReadWavFile.h ****     
  76:b3ReadWavFile.h ****   }
  77:b3ReadWavFile.h **** 	MemoryDataSource(const char* data, int numBytes)
  78:b3ReadWavFile.h **** 		:m_data(data),
  79:b3ReadWavFile.h **** 		m_numBytes(numBytes),
  80:b3ReadWavFile.h **** 		m_currentAddress(0)
  81:b3ReadWavFile.h **** 	{
  82:b3ReadWavFile.h **** 	}
  83:b3ReadWavFile.h **** 
  84:b3ReadWavFile.h **** 	const char* m_data;
  85:b3ReadWavFile.h **** 	int m_numBytes;
  86:b3ReadWavFile.h **** 	int m_currentAddress;
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 3


  87:b3ReadWavFile.h **** 
  88:b3ReadWavFile.h **** 	virtual long  ftell()
  30              		.loc 1 88 16 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
  89:b3ReadWavFile.h **** 	{
  90:b3ReadWavFile.h **** 		return m_currentAddress;
  35              		.loc 1 90 3 view .LVU1
  91:b3ReadWavFile.h **** 	}
  36              		.loc 1 91 2 is_stmt 0 view .LVU2
  37 0000 C068     		ldr	r0, [r0, #12]
  38              	.LVL1:
  39              		.loc 1 91 2 view .LVU3
  40 0002 7047     		bx	lr
  41              		.cfi_endproc
  42              	.LFE1435:
  44              		.section	.text._ZN16MemoryDataSource5freadEPvjj,"axG",%progbits,_ZN16MemoryDataSource5freadEPvjj,c
  45              		.align	1
  46              		.p2align 2,,3
  47              		.weak	_ZN16MemoryDataSource5freadEPvjj
  48              		.syntax unified
  49              		.thumb
  50              		.thumb_func
  51              		.fpu fpv5-d16
  53              	_ZN16MemoryDataSource5freadEPvjj:
  54              	.LVL2:
  55              	.LFB1436:
  92:b3ReadWavFile.h **** 
  93:b3ReadWavFile.h **** 	virtual size_t fread(void* _BufferOrg, size_t _ElementSize, size_t _ElementCount)
  56              		.loc 1 93 17 is_stmt 1 view -0
  57              		.cfi_startproc
  58              		@ args = 0, pretend = 0, frame = 0
  59              		@ frame_needed = 0, uses_anonymous_args = 0
  94:b3ReadWavFile.h **** 	{
  95:b3ReadWavFile.h **** 		char* _Buffer = (char*)_BufferOrg;
  60              		.loc 1 95 3 view .LVU5
  96:b3ReadWavFile.h **** 		int writeIndex = 0;
  61              		.loc 1 96 3 view .LVU6
  97:b3ReadWavFile.h **** 		int i = 0;
  62              		.loc 1 97 3 view .LVU7
  98:b3ReadWavFile.h **** 		for (i = 0; i < _ElementCount; i++)
  63              		.loc 1 98 3 view .LVU8
  64              	.LBB51:
  65              		.loc 1 98 17 view .LVU9
  66 0000 FBB1     		cbz	r3, .L17
  67              	.LBE51:
  93:b3ReadWavFile.h **** 	{
  68              		.loc 1 93 17 is_stmt 0 view .LVU10
  69 0002 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
  70              		.cfi_def_cfa_offset 24
  71              		.cfi_offset 4, -24
  72              		.cfi_offset 5, -20
  73              		.cfi_offset 6, -16
  74              		.cfi_offset 7, -12
  75              		.cfi_offset 8, -8
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 4


  76              		.cfi_offset 14, -4
  77              	.LBB53:
  78              		.loc 1 98 10 view .LVU11
  79 0006 0027     		movs	r7, #0
  80 0008 8846     		mov	r8, r1
  81              	.LBE53:
  96:b3ReadWavFile.h **** 		int i = 0;
  82              		.loc 1 96 7 view .LVU12
  83 000a BC46     		mov	ip, r7
  84              	.LVL3:
  85              	.L7:
  86              	.LBB54:
  87              	.LBB52:
  99:b3ReadWavFile.h **** 		{
 100:b3ReadWavFile.h **** 			for (int j = 0; j < _ElementSize; j++)
  88              		.loc 1 100 22 is_stmt 1 view .LVU13
  89 000c 9AB1     		cbz	r2, .L5
  90 000e 0CF1FF3E 		add	lr, ip, #-1
  91 0012 0CEB0206 		add	r6, ip, r2
  92 0016 C644     		add	lr, lr, r8
  93 0018 08E0     		b	.L6
  94              	.L20:
 101:b3ReadWavFile.h **** 			{
 102:b3ReadWavFile.h **** 				if (m_currentAddress < m_numBytes)
 103:b3ReadWavFile.h **** 				{
 104:b3ReadWavFile.h **** 					_Buffer[writeIndex++] = m_data[m_currentAddress++];
  95              		.loc 1 104 55 is_stmt 0 view .LVU14
  96 001a 4168     		ldr	r1, [r0, #4]
  97              		.loc 1 104 24 view .LVU15
  98 001c 0CF1010C 		add	ip, ip, #1
  99              	.LVL4:
 100              		.loc 1 104 53 view .LVU16
 101 0020 C560     		str	r5, [r0, #12]
 100:b3ReadWavFile.h **** 			{
 102              		.loc 1 100 22 view .LVU17
 103 0022 6645     		cmp	r6, ip
 104              		.loc 1 104 55 view .LVU18
 105 0024 0C5D     		ldrb	r4, [r1, r4]	@ zero_extendqisi2
 106              		.loc 1 104 28 view .LVU19
 107 0026 0EF8014F 		strb	r4, [lr, #1]!
 100:b3ReadWavFile.h **** 			{
 108              		.loc 1 100 4 is_stmt 1 view .LVU20
 100:b3ReadWavFile.h **** 			{
 109              		.loc 1 100 22 view .LVU21
 110 002a 04D0     		beq	.L5
 111              	.L6:
 102:b3ReadWavFile.h **** 				{
 112              		.loc 1 102 5 view .LVU22
 113              		.loc 1 104 6 view .LVU23
 102:b3ReadWavFile.h **** 				{
 114              		.loc 1 102 9 is_stmt 0 view .LVU24
 115 002c C468     		ldr	r4, [r0, #12]
 102:b3ReadWavFile.h **** 				{
 116              		.loc 1 102 5 view .LVU25
 117 002e 8168     		ldr	r1, [r0, #8]
 118              		.loc 1 104 53 view .LVU26
 119 0030 651C     		adds	r5, r4, #1
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 5


 102:b3ReadWavFile.h **** 				{
 120              		.loc 1 102 5 view .LVU27
 121 0032 8C42     		cmp	r4, r1
 122 0034 F1DB     		blt	.L20
 123              	.L5:
 102:b3ReadWavFile.h **** 				{
 124              		.loc 1 102 5 view .LVU28
 125              	.LBE52:
  98:b3ReadWavFile.h **** 		{
 126              		.loc 1 98 3 is_stmt 1 discriminator 2 view .LVU29
 127 0036 0137     		adds	r7, r7, #1
 128              	.LVL5:
  98:b3ReadWavFile.h **** 		{
 129              		.loc 1 98 17 discriminator 2 view .LVU30
 130 0038 9F42     		cmp	r7, r3
 131 003a E7D1     		bne	.L7
  98:b3ReadWavFile.h **** 		{
 132              		.loc 1 98 17 is_stmt 0 discriminator 2 view .LVU31
 133              	.LBE54:
 105:b3ReadWavFile.h **** 				}
 106:b3ReadWavFile.h **** 				else
 107:b3ReadWavFile.h **** 				{
 108:b3ReadWavFile.h **** 					break;
 109:b3ReadWavFile.h **** 					assert(0);
 110:b3ReadWavFile.h **** 				}
 111:b3ReadWavFile.h **** 			}
 112:b3ReadWavFile.h **** 		}
 113:b3ReadWavFile.h **** 		return i;
 134              		.loc 1 113 3 is_stmt 1 view .LVU32
 114:b3ReadWavFile.h **** 	}
 135              		.loc 1 114 2 is_stmt 0 view .LVU33
 136 003c 1846     		mov	r0, r3
 137              	.LVL6:
 138              		.loc 1 114 2 view .LVU34
 139 003e BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 140              	.LVL7:
 141              	.L17:
 142              		.cfi_def_cfa_offset 0
 143              		.cfi_restore 4
 144              		.cfi_restore 5
 145              		.cfi_restore 6
 146              		.cfi_restore 7
 147              		.cfi_restore 8
 148              		.cfi_restore 14
 113:b3ReadWavFile.h **** 	}
 149              		.loc 1 113 3 is_stmt 1 view .LVU35
 150              		.loc 1 114 2 is_stmt 0 view .LVU36
 151 0042 1846     		mov	r0, r3
 152              	.LVL8:
 153              		.loc 1 114 2 view .LVU37
 154 0044 7047     		bx	lr
 155              		.cfi_endproc
 156              	.LFE1436:
 158 0046 00BF     		.section	.text._ZN16MemoryDataSource5fseekEli,"axG",%progbits,_ZN16MemoryDataSource5fseekEli,comda
 159              		.align	1
 160              		.p2align 2,,3
 161              		.weak	_ZN16MemoryDataSource5fseekEli
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 6


 162              		.syntax unified
 163              		.thumb
 164              		.thumb_func
 165              		.fpu fpv5-d16
 167              	_ZN16MemoryDataSource5fseekEli:
 168              	.LVL9:
 169              	.LFB1437:
 115:b3ReadWavFile.h **** 
 116:b3ReadWavFile.h **** 
 117:b3ReadWavFile.h **** 	virtual int fseek(long  _Offset, int   _Origin)
 170              		.loc 1 117 14 is_stmt 1 view -0
 171              		.cfi_startproc
 172              		@ args = 0, pretend = 0, frame = 0
 173              		@ frame_needed = 0, uses_anonymous_args = 0
 174              		@ link register save eliminated.
 118:b3ReadWavFile.h **** 	{
 119:b3ReadWavFile.h **** 		switch (_Origin)
 175              		.loc 1 119 3 view .LVU39
 176 0000 0A2A     		cmp	r2, #10
 177 0002 0BD0     		beq	.L22
 178 0004 0B2A     		cmp	r2, #11
 179 0006 0BD0     		beq	.L23
 120:b3ReadWavFile.h **** 		{
 121:b3ReadWavFile.h **** 			case B3_SEEK_CUR:
 122:b3ReadWavFile.h **** 			{
 123:b3ReadWavFile.h **** 				m_currentAddress += _Offset;
 124:b3ReadWavFile.h **** 				break;
 125:b3ReadWavFile.h **** 			}
 126:b3ReadWavFile.h **** 			case B3_SEEK_SET:
 127:b3ReadWavFile.h **** 			{
 128:b3ReadWavFile.h **** 				m_currentAddress = _Offset;
 129:b3ReadWavFile.h **** 				break;
 130:b3ReadWavFile.h **** 			}
 131:b3ReadWavFile.h **** 			default:
 132:b3ReadWavFile.h **** 			{
 133:b3ReadWavFile.h **** 			}
 134:b3ReadWavFile.h **** 		}
 135:b3ReadWavFile.h **** 		int result = -1;
 136:b3ReadWavFile.h **** 		if (m_currentAddress >= 0 && m_currentAddress < m_numBytes)
 180              		.loc 1 136 7 is_stmt 0 view .LVU40
 181 0008 C168     		ldr	r1, [r0, #12]
 182              	.LVL10:
 183              	.L24:
 131:b3ReadWavFile.h **** 			{
 184              		.loc 1 131 4 is_stmt 1 view .LVU41
 132:b3ReadWavFile.h **** 			}
 185              		.loc 1 132 4 view .LVU42
 135:b3ReadWavFile.h **** 		if (m_currentAddress >= 0 && m_currentAddress < m_numBytes)
 186              		.loc 1 135 3 view .LVU43
 187              		.loc 1 136 3 view .LVU44
 188 000a 0029     		cmp	r1, #0
 189 000c 0CDB     		blt	.L26
 190              		.loc 1 136 29 is_stmt 0 discriminator 1 view .LVU45
 191 000e 8068     		ldr	r0, [r0, #8]
 192              	.LVL11:
 193              		.loc 1 136 29 discriminator 1 view .LVU46
 194 0010 8842     		cmp	r0, r1
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 7


 195 0012 4FF0FF30 		mov	r0, #-1
 196 0016 C8BF     		it	gt
 197 0018 0020     		movgt	r0, #0
 198 001a 7047     		bx	lr
 199              	.LVL12:
 200              	.L22:
 126:b3ReadWavFile.h **** 			{
 201              		.loc 1 126 4 is_stmt 1 view .LVU47
 127:b3ReadWavFile.h **** 				m_currentAddress = _Offset;
 202              		.loc 1 127 4 view .LVU48
 128:b3ReadWavFile.h **** 				break;
 203              		.loc 1 128 5 view .LVU49
 128:b3ReadWavFile.h **** 				break;
 204              		.loc 1 128 22 is_stmt 0 view .LVU50
 205 001c C160     		str	r1, [r0, #12]
 129:b3ReadWavFile.h **** 			}
 206              		.loc 1 129 5 is_stmt 1 view .LVU51
 207 001e F4E7     		b	.L24
 208              	.L23:
 121:b3ReadWavFile.h **** 			{
 209              		.loc 1 121 4 view .LVU52
 122:b3ReadWavFile.h **** 				m_currentAddress += _Offset;
 210              		.loc 1 122 4 view .LVU53
 123:b3ReadWavFile.h **** 				break;
 211              		.loc 1 123 5 view .LVU54
 123:b3ReadWavFile.h **** 				break;
 212              		.loc 1 123 22 is_stmt 0 view .LVU55
 213 0020 C368     		ldr	r3, [r0, #12]
 214 0022 1944     		add	r1, r1, r3
 215              	.LVL13:
 123:b3ReadWavFile.h **** 				break;
 216              		.loc 1 123 22 view .LVU56
 217 0024 C160     		str	r1, [r0, #12]
 124:b3ReadWavFile.h **** 			}
 218              		.loc 1 124 5 is_stmt 1 view .LVU57
 219 0026 F0E7     		b	.L24
 220              	.LVL14:
 221              	.L26:
 135:b3ReadWavFile.h **** 		if (m_currentAddress >= 0 && m_currentAddress < m_numBytes)
 222              		.loc 1 135 7 is_stmt 0 view .LVU58
 223 0028 4FF0FF30 		mov	r0, #-1
 224              	.LVL15:
 137:b3ReadWavFile.h **** 			result = 0;
 138:b3ReadWavFile.h **** 		return result;
 225              		.loc 1 138 3 is_stmt 1 view .LVU59
 139:b3ReadWavFile.h **** 	}
 226              		.loc 1 139 2 is_stmt 0 view .LVU60
 227 002c 7047     		bx	lr
 228              		.cfi_endproc
 229              	.LFE1437:
 231 002e 00BF     		.section	.text._ZN13SampleLibrary14loadSampleDataEi.part.0,"ax",%progbits
 232              		.align	1
 233              		.p2align 2,,3
 234              		.syntax unified
 235              		.thumb
 236              		.thumb_func
 237              		.fpu fpv5-d16
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 8


 239              	_ZN13SampleLibrary14loadSampleDataEi.part.0:
 240              	.LVL16:
 241              	.LFB4040:
 242              		.file 2 "SampleLibrary.cpp"
   1:SampleLibrary.cpp **** #include "SampleLibrary.h"
   2:SampleLibrary.cpp **** 
   3:SampleLibrary.cpp **** // External memory allocator from main.cpp
   4:SampleLibrary.cpp **** extern char custom_pool[];
   5:SampleLibrary.cpp **** extern size_t pool_index;
   6:SampleLibrary.cpp **** extern const size_t CUSTOM_POOL_SIZE;
   7:SampleLibrary.cpp **** 
   8:SampleLibrary.cpp **** // Helper function to allocate from SDRAM pool
   9:SampleLibrary.cpp **** extern void* custom_pool_allocate(size_t size);
  10:SampleLibrary.cpp **** 
  11:SampleLibrary.cpp **** SampleLibrary::SampleLibrary(daisy::SdmmcHandler& sdHandler, FatFSInterface& fileSystem)
  12:SampleLibrary.cpp ****     : sdHandler_(sdHandler),
  13:SampleLibrary.cpp ****       fileSystem_(fileSystem),
  14:SampleLibrary.cpp ****       sampleCount_(0)
  15:SampleLibrary.cpp **** {
  16:SampleLibrary.cpp ****     // Initialize all samples as not loaded
  17:SampleLibrary.cpp ****     for (int i = 0; i < MAX_SAMPLES; i++) {
  18:SampleLibrary.cpp ****         samples_[i].loaded = false;
  19:SampleLibrary.cpp ****         samples_[i].audioDataLoaded = false;
  20:SampleLibrary.cpp ****     }
  21:SampleLibrary.cpp **** }
  22:SampleLibrary.cpp **** 
  23:SampleLibrary.cpp **** bool SampleLibrary::init() {
  24:SampleLibrary.cpp ****     // Mount the SD card file system
  25:SampleLibrary.cpp ****     FATFS& fs = fileSystem_.GetSDFileSystem();
  26:SampleLibrary.cpp ****     if (f_mount(&fs, "/", 1) != FR_OK) {
  27:SampleLibrary.cpp ****         return false;  // Failed to mount
  28:SampleLibrary.cpp ****     }
  29:SampleLibrary.cpp ****     
  30:SampleLibrary.cpp ****     // Open the root directory
  31:SampleLibrary.cpp ****     DIR dir;
  32:SampleLibrary.cpp ****     if (f_opendir(&dir, "/") != FR_OK) {
  33:SampleLibrary.cpp ****         return false;  // Failed to open directory
  34:SampleLibrary.cpp ****     }
  35:SampleLibrary.cpp ****     
  36:SampleLibrary.cpp ****     // Scan for WAV files
  37:SampleLibrary.cpp ****     FILINFO fno;
  38:SampleLibrary.cpp ****     FRESULT result;
  39:SampleLibrary.cpp ****     
  40:SampleLibrary.cpp ****     do {
  41:SampleLibrary.cpp ****         result = f_readdir(&dir, &fno);
  42:SampleLibrary.cpp ****         
  43:SampleLibrary.cpp ****         // Exit on error or end of directory
  44:SampleLibrary.cpp ****         if (result != FR_OK || fno.fname[0] == 0) {
  45:SampleLibrary.cpp ****             break;
  46:SampleLibrary.cpp ****         }
  47:SampleLibrary.cpp ****         
  48:SampleLibrary.cpp ****         // Skip directories and hidden files
  49:SampleLibrary.cpp ****         if (fno.fattrib & (AM_HID | AM_DIR)) {
  50:SampleLibrary.cpp ****             continue;
  51:SampleLibrary.cpp ****         }
  52:SampleLibrary.cpp ****         
  53:SampleLibrary.cpp ****         // Check if it's a .wav file
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 9


  54:SampleLibrary.cpp ****         const char* filename = fno.fname;
  55:SampleLibrary.cpp ****         if (strstr(filename, ".wav") == nullptr && 
  56:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
  57:SampleLibrary.cpp ****             continue;  // Not a WAV file
  58:SampleLibrary.cpp ****         }
  59:SampleLibrary.cpp ****         
  60:SampleLibrary.cpp ****         // Try to load this sample
  61:SampleLibrary.cpp ****         if (sampleCount_ < MAX_SAMPLES) {
  62:SampleLibrary.cpp ****             if (loadSampleInfo(filename, sampleCount_)) {
  63:SampleLibrary.cpp ****                 sampleCount_++;
  64:SampleLibrary.cpp ****             }
  65:SampleLibrary.cpp ****         } else {
  66:SampleLibrary.cpp ****             break;  // Reached maximum samples
  67:SampleLibrary.cpp ****         }
  68:SampleLibrary.cpp ****         
  69:SampleLibrary.cpp ****     } while (result == FR_OK);
  70:SampleLibrary.cpp ****     
  71:SampleLibrary.cpp ****     // Close directory
  72:SampleLibrary.cpp ****     f_closedir(&dir);
  73:SampleLibrary.cpp ****     
  74:SampleLibrary.cpp ****     return true;
  75:SampleLibrary.cpp **** }
  76:SampleLibrary.cpp **** 
  77:SampleLibrary.cpp **** bool SampleLibrary::loadSampleInfo(const char* filename, int index) {
  78:SampleLibrary.cpp ****     // Open the file
  79:SampleLibrary.cpp ****     FIL file;
  80:SampleLibrary.cpp ****     if (f_open(&file, filename, FA_OPEN_EXISTING | FA_READ) != FR_OK) {
  81:SampleLibrary.cpp ****         return false;  // Failed to open
  82:SampleLibrary.cpp ****     }
  83:SampleLibrary.cpp ****     
  84:SampleLibrary.cpp ****     // Read only the WAV header (first 44 bytes)
  85:SampleLibrary.cpp ****     // WAV header structure: RIFF(4) + filesize(4) + WAVE(4) + fmt(4) +
  86:SampleLibrary.cpp ****     //                       fmt_size(4) + audio_fmt(2) + channels(2) +
  87:SampleLibrary.cpp ****     //                       sample_rate(4) + byte_rate(4) + block_align(2) +
  88:SampleLibrary.cpp ****     //                       bits_per_sample(2) + data(4) + data_size(4) = 44 bytes
  89:SampleLibrary.cpp ****     const int WAV_HEADER_SIZE = 44;
  90:SampleLibrary.cpp ****     char headerBuffer[WAV_HEADER_SIZE];
  91:SampleLibrary.cpp ****     
  92:SampleLibrary.cpp ****     UINT bytesRead;
  93:SampleLibrary.cpp ****     if (f_read(&file, headerBuffer, WAV_HEADER_SIZE, &bytesRead) != FR_OK || bytesRead != WAV_HEADE
  94:SampleLibrary.cpp ****         f_close(&file);
  95:SampleLibrary.cpp ****         return false;  // Failed to read header
  96:SampleLibrary.cpp ****     }
  97:SampleLibrary.cpp ****     
  98:SampleLibrary.cpp ****     // Close the file - we only needed the header
  99:SampleLibrary.cpp ****     f_close(&file);
 100:SampleLibrary.cpp ****     
 101:SampleLibrary.cpp ****     // Store filename
 102:SampleLibrary.cpp ****     strncpy(samples_[index].name, filename, 31);
 103:SampleLibrary.cpp ****     samples_[index].name[31] = '\0';  // Ensure null-terminated
 104:SampleLibrary.cpp ****     
 105:SampleLibrary.cpp ****     // Create MemoryDataSource pointing to header buffer (temporary)
 106:SampleLibrary.cpp ****     samples_[index].data = MemoryDataSource(headerBuffer, WAV_HEADER_SIZE);
 107:SampleLibrary.cpp ****     
 108:SampleLibrary.cpp ****     // Parse WAV header using b3ReadWavFile
 109:SampleLibrary.cpp ****     if (!samples_[index].reader.getWavInfo(samples_[index].data)) {
 110:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 10


 111:SampleLibrary.cpp ****     }
 112:SampleLibrary.cpp ****     
 113:SampleLibrary.cpp ****     // Extract metadata from the reader
 114:SampleLibrary.cpp ****     samples_[index].numFrames = samples_[index].reader.getNumFrames();
 115:SampleLibrary.cpp ****     samples_[index].sampleRate = (int)samples_[index].reader.getFileDataRate();
 116:SampleLibrary.cpp ****     samples_[index].loaded = true;           // Metadata is loaded
 117:SampleLibrary.cpp ****     samples_[index].audioDataLoaded = false;  // Audio data NOT loaded yet
 118:SampleLibrary.cpp ****     
 119:SampleLibrary.cpp ****     // Determine channels and bits per sample from reader
 120:SampleLibrary.cpp ****     samples_[index].channels = 2;
 121:SampleLibrary.cpp ****     samples_[index].bitsPerSample = 16;
 122:SampleLibrary.cpp ****     
 123:SampleLibrary.cpp ****     return true;
 124:SampleLibrary.cpp **** }
 125:SampleLibrary.cpp **** 
 126:SampleLibrary.cpp **** bool SampleLibrary::loadSampleData(int index) {
 243              		.loc 2 126 6 is_stmt 1 view -0
 244              		.cfi_startproc
 245              		@ args = 0, pretend = 0, frame = 560
 246              		@ frame_needed = 0, uses_anonymous_args = 0
 247              		.loc 2 126 6 is_stmt 0 view .LVU62
 248 0000 C1EBC101 		rsb	r1, r1, r1, lsl #3
 249              	.LVL17:
 127:SampleLibrary.cpp ****     // Check if already loaded
 128:SampleLibrary.cpp ****     if (samples_[index].audioDataLoaded) {
 129:SampleLibrary.cpp ****         return true;  // Already loaded
 130:SampleLibrary.cpp ****     }
 131:SampleLibrary.cpp ****     
 132:SampleLibrary.cpp ****     // Open the file
 133:SampleLibrary.cpp ****     FIL file;
 134:SampleLibrary.cpp ****     if (f_open(&file, samples_[index].name, FA_OPEN_EXISTING | FA_READ) != FR_OK) {
 250              		.loc 2 134 15 view .LVU63
 251 0004 0122     		movs	r2, #1
 126:SampleLibrary.cpp ****     // Check if already loaded
 252              		.loc 2 126 6 view .LVU64
 253 0006 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 254              		.cfi_def_cfa_offset 28
 255              		.cfi_offset 4, -28
 256              		.cfi_offset 5, -24
 257              		.cfi_offset 6, -20
 258              		.cfi_offset 7, -16
 259              		.cfi_offset 8, -12
 260              		.cfi_offset 9, -8
 261              		.cfi_offset 14, -4
 262              		.loc 2 134 39 view .LVU65
 263 000a 00EB0116 		add	r6, r0, r1, lsl #4
 126:SampleLibrary.cpp ****     // Check if already loaded
 264              		.loc 2 126 6 view .LVU66
 265 000e ADF50D7D 		sub	sp, sp, #564
 266              		.cfi_def_cfa_offset 592
 126:SampleLibrary.cpp ****     // Check if already loaded
 267              		.loc 2 126 6 view .LVU67
 268 0012 0746     		mov	r7, r0
 133:SampleLibrary.cpp ****     if (f_open(&file, samples_[index].name, FA_OPEN_EXISTING | FA_READ) != FR_OK) {
 269              		.loc 2 133 5 is_stmt 1 view .LVU68
 270              		.loc 2 134 5 view .LVU69
 271 0014 0C01     		lsls	r4, r1, #4
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 11


 272              		.loc 2 134 15 is_stmt 0 view .LVU70
 273 0016 01A8     		add	r0, sp, #4
 274              	.LVL18:
 275              		.loc 2 134 15 view .LVU71
 276 0018 3146     		mov	r1, r6
 277 001a FFF7FEFF 		bl	f_open
 278              	.LVL19:
 279              		.loc 2 134 5 view .LVU72
 280 001e 20B1     		cbz	r0, .L28
 281              	.L37:
 135:SampleLibrary.cpp ****         return false;  // Failed to open
 136:SampleLibrary.cpp ****     }
 137:SampleLibrary.cpp ****     
 138:SampleLibrary.cpp ****     // Get file size
 139:SampleLibrary.cpp ****     UINT fileSize = f_size(&file);
 140:SampleLibrary.cpp ****     
 141:SampleLibrary.cpp ****     // Allocate memory from SDRAM pool
 142:SampleLibrary.cpp ****     char* buffer = (char*)custom_pool_allocate(fileSize);
 143:SampleLibrary.cpp ****     if (buffer == nullptr) {
 144:SampleLibrary.cpp ****         f_close(&file);
 145:SampleLibrary.cpp ****         return false;  // Out of memory
 282              		.loc 2 145 9 is_stmt 1 view .LVU73
 283              		.loc 2 145 16 is_stmt 0 view .LVU74
 284 0020 0020     		movs	r0, #0
 146:SampleLibrary.cpp ****     }
 147:SampleLibrary.cpp ****     
 148:SampleLibrary.cpp ****     // Read the entire file into memory
 149:SampleLibrary.cpp ****     UINT bytesRead;
 150:SampleLibrary.cpp ****     if (f_read(&file, buffer, fileSize, &bytesRead) != FR_OK) {
 151:SampleLibrary.cpp ****         f_close(&file);
 152:SampleLibrary.cpp ****         return false;  // Failed to read
 153:SampleLibrary.cpp ****     }
 154:SampleLibrary.cpp ****     
 155:SampleLibrary.cpp ****     // Close the file
 156:SampleLibrary.cpp ****     f_close(&file);
 157:SampleLibrary.cpp ****     
 158:SampleLibrary.cpp ****     // Update MemoryDataSource to point to full file buffer
 159:SampleLibrary.cpp ****     samples_[index].data = MemoryDataSource(buffer, fileSize);
 160:SampleLibrary.cpp ****     
 161:SampleLibrary.cpp ****     // Re-parse WAV header with the full buffer
 162:SampleLibrary.cpp ****     if (!samples_[index].reader.getWavInfo(samples_[index].data)) {
 163:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 164:SampleLibrary.cpp ****     }
 165:SampleLibrary.cpp ****     
 166:SampleLibrary.cpp ****     // Mark audio data as loaded
 167:SampleLibrary.cpp ****     samples_[index].audioDataLoaded = true;
 168:SampleLibrary.cpp ****     
 169:SampleLibrary.cpp ****     return true;
 170:SampleLibrary.cpp **** }
 285              		.loc 2 170 1 view .LVU75
 286 0022 0DF50D7D 		add	sp, sp, #564
 287              		.cfi_remember_state
 288              		.cfi_def_cfa_offset 28
 289              		@ sp needed
 290 0026 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 291              	.LVL20:
 292              	.L28:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 12


 293              		.cfi_restore_state
 139:SampleLibrary.cpp ****     
 294              		.loc 2 139 5 is_stmt 1 view .LVU76
 139:SampleLibrary.cpp ****     
 295              		.loc 2 139 10 is_stmt 0 view .LVU77
 296 002a DDF81090 		ldr	r9, [sp, #16]
 297              	.LVL21:
 142:SampleLibrary.cpp ****     if (buffer == nullptr) {
 298              		.loc 2 142 5 is_stmt 1 view .LVU78
 142:SampleLibrary.cpp ****     if (buffer == nullptr) {
 299              		.loc 2 142 47 is_stmt 0 view .LVU79
 300 002e 4846     		mov	r0, r9
 301 0030 FFF7FEFF 		bl	_Z20custom_pool_allocatej
 302              	.LVL22:
 143:SampleLibrary.cpp ****         f_close(&file);
 303              		.loc 2 143 5 is_stmt 1 view .LVU80
 304 0034 0546     		mov	r5, r0
 305 0036 F0B1     		cbz	r0, .L31
 149:SampleLibrary.cpp ****     if (f_read(&file, buffer, fileSize, &bytesRead) != FR_OK) {
 306              		.loc 2 149 5 view .LVU81
 150:SampleLibrary.cpp ****         f_close(&file);
 307              		.loc 2 150 5 view .LVU82
 150:SampleLibrary.cpp ****         f_close(&file);
 308              		.loc 2 150 15 is_stmt 0 view .LVU83
 309 0038 0146     		mov	r1, r0
 310 003a 6B46     		mov	r3, sp
 311 003c 4A46     		mov	r2, r9
 312 003e 01A8     		add	r0, sp, #4
 313              	.LVL23:
 150:SampleLibrary.cpp ****         f_close(&file);
 314              		.loc 2 150 15 view .LVU84
 315 0040 FFF7FEFF 		bl	f_read
 316              	.LVL24:
 150:SampleLibrary.cpp ****         f_close(&file);
 317              		.loc 2 150 5 view .LVU85
 318 0044 8046     		mov	r8, r0
 319 0046 B0B9     		cbnz	r0, .L31
 156:SampleLibrary.cpp ****     
 320              		.loc 2 156 5 is_stmt 1 view .LVU86
 156:SampleLibrary.cpp ****     
 321              		.loc 2 156 12 is_stmt 0 view .LVU87
 322 0048 01A8     		add	r0, sp, #4
 323 004a FFF7FEFF 		bl	f_close
 324              	.LVL25:
 159:SampleLibrary.cpp ****     
 325              		.loc 2 159 5 is_stmt 1 view .LVU88
 326              	.LBB55:
 327              	.LBI55:
  77:b3ReadWavFile.h **** 		:m_data(data),
 328              		.loc 1 77 2 view .LVU89
 329              	.LBB56:
 330              	.LBI56:
  13:b3ReadWavFile.h **** {
 331              		.loc 1 13 8 view .LVU90
  13:b3ReadWavFile.h **** {
 332              		.loc 1 13 8 is_stmt 0 view .LVU91
 333              	.LBE56:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 13


 334              	.LBE55:
 335              	.LBB57:
 336              	.LBI57:
  67:b3ReadWavFile.h **** {
 337              		.loc 1 67 8 is_stmt 1 view .LVU92
 338              	.LBE57:
 162:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 339              		.loc 2 162 43 is_stmt 0 view .LVU93
 340 004e 04F13001 		add	r1, r4, #48
 341 0052 4034     		adds	r4, r4, #64
 342              	.LBB60:
 343              	.LBB58:
  67:b3ReadWavFile.h **** {
 344              		.loc 1 67 8 view .LVU94
 345 0054 C6F83C80 		str	r8, [r6, #60]
 346              	.LVL26:
  67:b3ReadWavFile.h **** {
 347              		.loc 1 67 8 view .LVU95
 348              	.LBE58:
 349              	.LBE60:
 162:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 350              		.loc 2 162 5 is_stmt 1 view .LVU96
 162:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 351              		.loc 2 162 43 is_stmt 0 view .LVU97
 352 0058 3944     		add	r1, r1, r7
 353 005a 3819     		adds	r0, r7, r4
 354              	.LBB61:
 355              	.LBB59:
  67:b3ReadWavFile.h **** {
 356              		.loc 1 67 8 view .LVU98
 357 005c C6E90D59 		strd	r5, r9, [r6, #52]
 358              	.LBE59:
 359              	.LBE61:
 162:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 360              		.loc 2 162 43 view .LVU99
 361 0060 FFF7FEFF 		bl	_ZN13b3ReadWavFile10getWavInfoER12b3DataSource
 362              	.LVL27:
 162:SampleLibrary.cpp ****         return false;  // Failed to parse WAV
 363              		.loc 2 162 5 view .LVU100
 364 0064 0028     		cmp	r0, #0
 365 0066 DBD0     		beq	.L37
 167:SampleLibrary.cpp ****     
 366              		.loc 2 167 5 is_stmt 1 view .LVU101
 167:SampleLibrary.cpp ****     
 367              		.loc 2 167 37 is_stmt 0 view .LVU102
 368 0068 0123     		movs	r3, #1
 369 006a 86F86930 		strb	r3, [r6, #105]
 169:SampleLibrary.cpp **** }
 370              		.loc 2 169 5 is_stmt 1 view .LVU103
 371              		.loc 2 170 1 is_stmt 0 view .LVU104
 372 006e 0DF50D7D 		add	sp, sp, #564
 373              		.cfi_remember_state
 374              		.cfi_def_cfa_offset 28
 375              		@ sp needed
 376 0072 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 377              	.LVL28:
 378              	.L31:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 14


 379              		.cfi_restore_state
 144:SampleLibrary.cpp ****         return false;  // Out of memory
 380              		.loc 2 144 9 is_stmt 1 view .LVU105
 144:SampleLibrary.cpp ****         return false;  // Out of memory
 381              		.loc 2 144 16 is_stmt 0 view .LVU106
 382 0076 01A8     		add	r0, sp, #4
 383 0078 FFF7FEFF 		bl	f_close
 384              	.LVL29:
 385 007c D0E7     		b	.L37
 386              		.cfi_endproc
 387              	.LFE4040:
 389 007e 00BF     		.section	.text._ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE,"ax",%progbits
 390              		.align	1
 391              		.p2align 2,,3
 392              		.global	_ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE
 393              		.syntax unified
 394              		.thumb
 395              		.thumb_func
 396              		.fpu fpv5-d16
 398              	_ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE:
 399              	.LVL30:
 400              	.LFB3549:
  11:SampleLibrary.cpp ****     : sdHandler_(sdHandler),
 401              		.loc 2 11 1 is_stmt 1 view -0
 402              		.cfi_startproc
 403              		@ args = 0, pretend = 0, frame = 0
 404              		@ frame_needed = 0, uses_anonymous_args = 0
 405              	.LBB62:
  14:SampleLibrary.cpp **** {
 406              		.loc 2 14 21 view .LVU108
 407              	.LBE62:
  11:SampleLibrary.cpp ****     : sdHandler_(sdHandler),
 408              		.loc 2 11 1 is_stmt 0 view .LVU109
 409 0000 2DE9F84F 		push	{r3, r4, r5, r6, r7, r8, r9, r10, fp, lr}
 410              		.cfi_def_cfa_offset 40
 411              		.cfi_offset 3, -40
 412              		.cfi_offset 4, -36
 413              		.cfi_offset 5, -32
 414              		.cfi_offset 6, -28
 415              		.cfi_offset 7, -24
 416              		.cfi_offset 8, -20
 417              		.cfi_offset 9, -16
 418              		.cfi_offset 10, -12
 419              		.cfi_offset 11, -8
 420              		.cfi_offset 14, -4
  11:SampleLibrary.cpp ****     : sdHandler_(sdHandler),
 421              		.loc 2 11 1 view .LVU110
 422 0004 8146     		mov	r9, r0
 423 0006 8B46     		mov	fp, r1
 424 0008 9246     		mov	r10, r2
 425 000a 0546     		mov	r5, r0
 426 000c 00F5E057 		add	r7, r0, #7168
 427 0010 0446     		mov	r4, r0
 428 0012 DFF84480 		ldr	r8, .L44
 429              	.LVL31:
 430              	.L39:
 431              	.LBB75:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 15


 432              	.LBB63:
 433              	.LBI63:
 434              		.file 3 "SampleLibrary.h"
   1:SampleLibrary.h **** #ifndef SAMPLE_LIBRARY_H
   2:SampleLibrary.h **** #define SAMPLE_LIBRARY_H
   3:SampleLibrary.h **** 
   4:SampleLibrary.h **** #include "b3ReadWavFile.h"
   5:SampleLibrary.h **** #include "daisy_core.h"
   6:SampleLibrary.h **** #include "daisy_seed.h"
   7:SampleLibrary.h **** #include <string>
   8:SampleLibrary.h **** 
   9:SampleLibrary.h **** using namespace daisy;
  10:SampleLibrary.h **** using namespace std;
  11:SampleLibrary.h **** 
  12:SampleLibrary.h **** // Maximum number of samples we can load at once
  13:SampleLibrary.h **** #define MAX_SAMPLES 64
  14:SampleLibrary.h **** 
  15:SampleLibrary.h **** // Structure to hold information about a loaded sample
  16:SampleLibrary.h **** struct SampleInfo {
 435              		.loc 3 16 8 is_stmt 1 view .LVU111
 436              	.LBB64:
 437              	.LBB65:
 438              	.LBI65:
  70:b3ReadWavFile.h ****   :m_data(),
 439              		.loc 1 70 3 view .LVU112
 440              	.LBB66:
 441              	.LBB67:
 442              	.LBI67:
  13:b3ReadWavFile.h **** {
 443              		.loc 1 13 8 view .LVU113
  13:b3ReadWavFile.h **** {
 444              		.loc 1 13 8 is_stmt 0 view .LVU114
 445              	.LBE67:
  73:b3ReadWavFile.h ****   {
 446              		.loc 1 73 20 view .LVU115
 447 0016 C4F83080 		str	r8, [r4, #48]
 448              	.LBE66:
 449              	.LBE65:
 450              		.loc 3 16 8 view .LVU116
 451 001a 04F14000 		add	r0, r4, #64
 452              	.LBB70:
 453              	.LBB68:
  73:b3ReadWavFile.h ****   {
 454              		.loc 1 73 20 view .LVU117
 455 001e 0026     		movs	r6, #0
 456              	.LBE68:
 457              	.LBE70:
 458              	.LBE64:
 459              	.LBE63:
  14:SampleLibrary.cpp **** {
 460              		.loc 2 14 21 view .LVU118
 461 0020 7034     		adds	r4, r4, #112
 462              	.LVL32:
 463              	.LBB73:
 464              	.LBB72:
 465              	.LBB71:
 466              	.LBB69:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 16


  73:b3ReadWavFile.h ****   {
 467              		.loc 1 73 20 view .LVU119
 468 0022 44E90F66 		strd	r6, r6, [r4, #-60]
 469 0026 44F8346C 		str	r6, [r4, #-52]
 470              	.LVL33:
  73:b3ReadWavFile.h ****   {
 471              		.loc 1 73 20 view .LVU120
 472              	.LBE69:
 473              	.LBE71:
 474              		.loc 3 16 8 view .LVU121
 475 002a FFF7FEFF 		bl	_ZN13b3ReadWavFileC1Ev
 476              	.LVL34:
 477              		.loc 3 16 8 view .LVU122
 478              	.LBE72:
 479              	.LBE73:
  14:SampleLibrary.cpp **** {
 480              		.loc 2 14 21 is_stmt 1 view .LVU123
  14:SampleLibrary.cpp **** {
 481              		.loc 2 14 21 view .LVU124
 482 002e BC42     		cmp	r4, r7
 483 0030 F1D1     		bne	.L39
  14:SampleLibrary.cpp **** {
 484              		.loc 2 14 21 is_stmt 0 discriminator 2 view .LVU125
 485 0032 09F58053 		add	r3, r9, #4096
 486 0036 C3F8006C 		str	r6, [r3, #3072]
 487 003a C3F804BC 		str	fp, [r3, #3076]
 488 003e C3F808AC 		str	r10, [r3, #3080]
 489              	.LBE75:
  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 490              		.loc 2 17 5 is_stmt 1 discriminator 2 view .LVU126
 491              	.LVL35:
 492              	.LBB76:
 493              	.LBB74:
  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 494              		.loc 2 17 23 discriminator 2 view .LVU127
 495              	.L40:
  18:SampleLibrary.cpp ****         samples_[i].audioDataLoaded = false;
 496              		.loc 2 18 9 discriminator 2 view .LVU128
  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 497              		.loc 2 17 23 is_stmt 0 discriminator 2 view .LVU129
 498 0042 7035     		adds	r5, r5, #112
  18:SampleLibrary.cpp ****         samples_[i].audioDataLoaded = false;
 499              		.loc 2 18 28 discriminator 2 view .LVU130
 500 0044 0023     		movs	r3, #0
  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 501              		.loc 2 17 23 discriminator 2 view .LVU131
 502 0046 BD42     		cmp	r5, r7
  18:SampleLibrary.cpp ****         samples_[i].audioDataLoaded = false;
 503              		.loc 2 18 28 discriminator 2 view .LVU132
 504 0048 05F8083C 		strb	r3, [r5, #-8]
  19:SampleLibrary.cpp ****     }
 505              		.loc 2 19 9 is_stmt 1 discriminator 2 view .LVU133
  19:SampleLibrary.cpp ****     }
 506              		.loc 2 19 37 is_stmt 0 discriminator 2 view .LVU134
 507 004c 05F8073C 		strb	r3, [r5, #-7]
  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 508              		.loc 2 17 5 is_stmt 1 discriminator 2 view .LVU135
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 17


  17:SampleLibrary.cpp ****         samples_[i].loaded = false;
 509              		.loc 2 17 23 discriminator 2 view .LVU136
 510 0050 F7D1     		bne	.L40
 511              	.LBE74:
 512              	.LBE76:
  21:SampleLibrary.cpp **** 
 513              		.loc 2 21 1 is_stmt 0 view .LVU137
 514 0052 4846     		mov	r0, r9
 515 0054 BDE8F88F 		pop	{r3, r4, r5, r6, r7, r8, r9, r10, fp, pc}
 516              	.LVL36:
 517              	.L45:
  21:SampleLibrary.cpp **** 
 518              		.loc 2 21 1 view .LVU138
 519              		.align	2
 520              	.L44:
 521 0058 08000000 		.word	_ZTV16MemoryDataSource+8
 522              		.cfi_endproc
 523              	.LFE3549:
 525              		.global	_ZN13SampleLibraryC1ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE
 526              		.thumb_set _ZN13SampleLibraryC1ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE,_ZN13SampleLibraryC2
 527              		.section	.text._ZN13SampleLibrary14loadSampleInfoEPKci,"ax",%progbits
 528              		.align	1
 529              		.p2align 2,,3
 530              		.global	_ZN13SampleLibrary14loadSampleInfoEPKci
 531              		.syntax unified
 532              		.thumb
 533              		.thumb_func
 534              		.fpu fpv5-d16
 536              	_ZN13SampleLibrary14loadSampleInfoEPKci:
 537              	.LVL37:
 538              	.LFB3552:
  77:SampleLibrary.cpp ****     // Open the file
 539              		.loc 2 77 69 is_stmt 1 view -0
 540              		.cfi_startproc
 541              		@ args = 0, pretend = 0, frame = 608
 542              		@ frame_needed = 0, uses_anonymous_args = 0
  77:SampleLibrary.cpp ****     // Open the file
 543              		.loc 2 77 69 is_stmt 0 view .LVU140
 544 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 545              		.cfi_def_cfa_offset 24
 546              		.cfi_offset 4, -24
 547              		.cfi_offset 5, -20
 548              		.cfi_offset 6, -16
 549              		.cfi_offset 7, -12
 550              		.cfi_offset 8, -8
 551              		.cfi_offset 14, -4
 552 0004 ADF5187D 		sub	sp, sp, #608
 553              		.cfi_def_cfa_offset 632
  77:SampleLibrary.cpp ****     // Open the file
 554              		.loc 2 77 69 view .LVU141
 555 0008 0546     		mov	r5, r0
 556 000a 1446     		mov	r4, r2
  80:SampleLibrary.cpp ****         return false;  // Failed to open
 557              		.loc 2 80 15 view .LVU142
 558 000c 0122     		movs	r2, #1
 559              	.LVL38:
  80:SampleLibrary.cpp ****         return false;  // Failed to open
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 18


 560              		.loc 2 80 15 view .LVU143
 561 000e 0DA8     		add	r0, sp, #52
 562              	.LVL39:
  77:SampleLibrary.cpp ****     // Open the file
 563              		.loc 2 77 69 view .LVU144
 564 0010 0F46     		mov	r7, r1
  79:SampleLibrary.cpp ****     if (f_open(&file, filename, FA_OPEN_EXISTING | FA_READ) != FR_OK) {
 565              		.loc 2 79 5 is_stmt 1 view .LVU145
  80:SampleLibrary.cpp ****         return false;  // Failed to open
 566              		.loc 2 80 5 view .LVU146
  80:SampleLibrary.cpp ****         return false;  // Failed to open
 567              		.loc 2 80 15 is_stmt 0 view .LVU147
 568 0012 FFF7FEFF 		bl	f_open
 569              	.LVL40:
  80:SampleLibrary.cpp ****         return false;  // Failed to open
 570              		.loc 2 80 5 view .LVU148
 571 0016 20B1     		cbz	r0, .L47
 572              	.LVL41:
 573              	.L53:
  95:SampleLibrary.cpp ****     }
 574              		.loc 2 95 9 is_stmt 1 view .LVU149
  95:SampleLibrary.cpp ****     }
 575              		.loc 2 95 16 is_stmt 0 view .LVU150
 576 0018 0020     		movs	r0, #0
 577              	.L48:
 124:SampleLibrary.cpp **** 
 578              		.loc 2 124 1 view .LVU151
 579 001a 0DF5187D 		add	sp, sp, #608
 580              		.cfi_remember_state
 581              		.cfi_def_cfa_offset 24
 582              		@ sp needed
 583 001e BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 584              	.LVL42:
 585              	.L47:
 586              		.cfi_restore_state
  89:SampleLibrary.cpp ****     char headerBuffer[WAV_HEADER_SIZE];
 587              		.loc 2 89 5 is_stmt 1 view .LVU152
  90:SampleLibrary.cpp ****     
 588              		.loc 2 90 5 view .LVU153
  92:SampleLibrary.cpp ****     if (f_read(&file, headerBuffer, WAV_HEADER_SIZE, &bytesRead) != FR_OK || bytesRead != WAV_HEADE
 589              		.loc 2 92 5 view .LVU154
  93:SampleLibrary.cpp ****         f_close(&file);
 590              		.loc 2 93 5 view .LVU155
  93:SampleLibrary.cpp ****         f_close(&file);
 591              		.loc 2 93 15 is_stmt 0 view .LVU156
 592 0022 2C22     		movs	r2, #44
 593 0024 0DA8     		add	r0, sp, #52
 594 0026 01AB     		add	r3, sp, #4
 595 0028 02A9     		add	r1, sp, #8
 596 002a FFF7FEFF 		bl	f_read
 597              	.LVL43:
  93:SampleLibrary.cpp ****         f_close(&file);
 598              		.loc 2 93 75 view .LVU157
 599 002e 0646     		mov	r6, r0
  94:SampleLibrary.cpp ****         return false;  // Failed to read header
 600              		.loc 2 94 16 view .LVU158
 601 0030 0DA8     		add	r0, sp, #52
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 19


  93:SampleLibrary.cpp ****         f_close(&file);
 602              		.loc 2 93 75 view .LVU159
 603 0032 26B9     		cbnz	r6, .L49
  93:SampleLibrary.cpp ****         f_close(&file);
 604              		.loc 2 93 75 discriminator 2 view .LVU160
 605 0034 DDF80480 		ldr	r8, [sp, #4]
 606 0038 B8F12C0F 		cmp	r8, #44
 607 003c 02D0     		beq	.L54
 608              	.L49:
  94:SampleLibrary.cpp ****         return false;  // Failed to read header
 609              		.loc 2 94 9 is_stmt 1 view .LVU161
  94:SampleLibrary.cpp ****         return false;  // Failed to read header
 610              		.loc 2 94 16 is_stmt 0 view .LVU162
 611 003e FFF7FEFF 		bl	f_close
 612              	.LVL44:
 613 0042 E9E7     		b	.L53
 614              	.L54:
  99:SampleLibrary.cpp ****     
 615              		.loc 2 99 5 is_stmt 1 view .LVU163
 616 0044 C4EBC404 		rsb	r4, r4, r4, lsl #3
 617              	.LVL45:
  99:SampleLibrary.cpp ****     
 618              		.loc 2 99 12 is_stmt 0 view .LVU164
 619 0048 FFF7FEFF 		bl	f_close
 620              	.LVL46:
 102:SampleLibrary.cpp ****     samples_[index].name[31] = '\0';  // Ensure null-terminated
 621              		.loc 2 102 5 is_stmt 1 view .LVU165
 102:SampleLibrary.cpp ****     samples_[index].name[31] = '\0';  // Ensure null-terminated
 622              		.loc 2 102 12 is_stmt 0 view .LVU166
 623 004c 3946     		mov	r1, r7
 102:SampleLibrary.cpp ****     samples_[index].name[31] = '\0';  // Ensure null-terminated
 624              		.loc 2 102 29 view .LVU167
 625 004e 05EB0417 		add	r7, r5, r4, lsl #4
 626              	.LVL47:
 102:SampleLibrary.cpp ****     samples_[index].name[31] = '\0';  // Ensure null-terminated
 627              		.loc 2 102 12 view .LVU168
 628 0052 1F22     		movs	r2, #31
 629 0054 2401     		lsls	r4, r4, #4
 630 0056 3846     		mov	r0, r7
 631 0058 FFF7FEFF 		bl	strncpy
 632              	.LVL48:
 103:SampleLibrary.cpp ****     
 633              		.loc 2 103 5 is_stmt 1 view .LVU169
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 634              		.loc 2 109 43 is_stmt 0 view .LVU170
 635 005c 04F13001 		add	r1, r4, #48
 636              	.LBB77:
 637              	.LBB78:
  67:b3ReadWavFile.h **** {
 638              		.loc 1 67 8 view .LVU171
 639 0060 02AB     		add	r3, sp, #8
 640              	.LBE78:
 641              	.LBE77:
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 642              		.loc 2 109 43 view .LVU172
 643 0062 4034     		adds	r4, r4, #64
 644 0064 2944     		add	r1, r1, r5
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 20


 103:SampleLibrary.cpp ****     
 645              		.loc 2 103 30 view .LVU173
 646 0066 FE77     		strb	r6, [r7, #31]
 106:SampleLibrary.cpp ****     
 647              		.loc 2 106 5 is_stmt 1 view .LVU174
 648              	.LVL49:
 649              	.LBB80:
 650              	.LBI80:
  77:b3ReadWavFile.h **** 		:m_data(data),
 651              		.loc 1 77 2 view .LVU175
 652              	.LBB81:
 653              	.LBI81:
  13:b3ReadWavFile.h **** {
 654              		.loc 1 13 8 view .LVU176
  13:b3ReadWavFile.h **** {
 655              		.loc 1 13 8 is_stmt 0 view .LVU177
 656              	.LBE81:
 657              	.LBE80:
 658              	.LBB82:
 659              	.LBI77:
  67:b3ReadWavFile.h **** {
 660              		.loc 1 67 8 is_stmt 1 view .LVU178
 661              	.LBE82:
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 662              		.loc 2 109 43 is_stmt 0 view .LVU179
 663 0068 2819     		adds	r0, r5, r4
 664              	.LBB83:
 665              	.LBB79:
  67:b3ReadWavFile.h **** {
 666              		.loc 1 67 8 view .LVU180
 667 006a 7B63     		str	r3, [r7, #52]
 668 006c C7F83880 		str	r8, [r7, #56]
 669 0070 FE63     		str	r6, [r7, #60]
 670              	.LVL50:
  67:b3ReadWavFile.h **** {
 671              		.loc 1 67 8 view .LVU181
 672              	.LBE79:
 673              	.LBE83:
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 674              		.loc 2 109 5 is_stmt 1 view .LVU182
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 675              		.loc 2 109 43 is_stmt 0 view .LVU183
 676 0072 FFF7FEFF 		bl	_ZN13b3ReadWavFile10getWavInfoER12b3DataSource
 677              	.LVL51:
 109:SampleLibrary.cpp ****         return false;  // Failed to parse WAV header
 678              		.loc 2 109 5 view .LVU184
 679 0076 0028     		cmp	r0, #0
 680 0078 CED0     		beq	.L53
 114:SampleLibrary.cpp ****     samples_[index].sampleRate = (int)samples_[index].reader.getFileDataRate();
 681              		.loc 2 114 5 is_stmt 1 view .LVU185
 682              	.LVL52:
 683              	.LBB84:
 684              	.LBI84:
 140:b3ReadWavFile.h **** 
 141:b3ReadWavFile.h **** };
 142:b3ReadWavFile.h **** 
 143:b3ReadWavFile.h **** 
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 21


 144:b3ReadWavFile.h **** 
 145:b3ReadWavFile.h **** 
 146:b3ReadWavFile.h **** struct b3WavTicker
 147:b3ReadWavFile.h **** {
 148:b3ReadWavFile.h **** 	std::vector<double> lastFrame_;
 149:b3ReadWavFile.h **** 	bool finished_;
 150:b3ReadWavFile.h **** 	double time_;
 151:b3ReadWavFile.h **** 	double starttime_;
 152:b3ReadWavFile.h **** 	double endtime_;
 153:b3ReadWavFile.h **** 	double rate_;
 154:b3ReadWavFile.h **** 	double speed_;
 155:b3ReadWavFile.h **** 	int wavindex;
 156:b3ReadWavFile.h **** 	double env_volume()
 157:b3ReadWavFile.h **** 	{
 158:b3ReadWavFile.h **** 		double frac = 1. - (time_ - starttime_) / (endtime_ - starttime_);
 159:b3ReadWavFile.h **** 		return frac;
 160:b3ReadWavFile.h **** 	}
 161:b3ReadWavFile.h **** 
 162:b3ReadWavFile.h **** 	double env_volume2()
 163:b3ReadWavFile.h **** 	{
 164:b3ReadWavFile.h **** 		double frac = (time_ - starttime_) / (endtime_ - starttime_);
 165:b3ReadWavFile.h **** 		if (frac > 0.5)
 166:b3ReadWavFile.h **** 			return 1. - frac;
 167:b3ReadWavFile.h **** 		return frac;
 168:b3ReadWavFile.h **** 	}
 169:b3ReadWavFile.h **** };
 170:b3ReadWavFile.h **** 
 171:b3ReadWavFile.h **** class b3ReadWavFile
 172:b3ReadWavFile.h **** {
 173:b3ReadWavFile.h **** 	bool byteswap_;
 174:b3ReadWavFile.h **** 	bool wavFile_;
 175:b3ReadWavFile.h **** 	unsigned long m_numFrames;
 176:b3ReadWavFile.h **** 	unsigned long dataType_;
 177:b3ReadWavFile.h **** 	double fileDataRate_;
 178:b3ReadWavFile.h **** 	
 179:b3ReadWavFile.h **** 	unsigned long dataOffset_;
 180:b3ReadWavFile.h **** 	unsigned int channels_;
 181:b3ReadWavFile.h **** 	bool m_machineIsLittleEndian;
 182:b3ReadWavFile.h **** 
 183:b3ReadWavFile.h **** public:
 184:b3ReadWavFile.h **** 	b3ReadWavFile();
 185:b3ReadWavFile.h **** 	virtual ~b3ReadWavFile();
 186:b3ReadWavFile.h **** 
 187:b3ReadWavFile.h **** 	//btAlignedObjectArray<double> m_frames;
 188:b3ReadWavFile.h **** 
 189:b3ReadWavFile.h **** 	bool getWavInfo(b3DataSource& dataSource);
 190:b3ReadWavFile.h **** 
 191:b3ReadWavFile.h **** 	void normalize(double peak);
 192:b3ReadWavFile.h **** 
 193:b3ReadWavFile.h **** 	void interpolate(b3WavTicker *ticker, b3DataSource& dataSource, double speed, double volume, int s
 194:b3ReadWavFile.h **** 	void tick(b3WavTicker *ticker, b3DataSource& dataSource, double speed, double volume, int size, fl
 195:b3ReadWavFile.h **** 	
 196:b3ReadWavFile.h **** 	void resize();
 197:b3ReadWavFile.h **** 
 198:b3ReadWavFile.h **** 	b3WavTicker createWavTicker(double sampleRate);
 199:b3ReadWavFile.h **** 
 200:b3ReadWavFile.h **** 	int getNumFrames() const
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 22


 685              		.loc 1 200 6 view .LVU186
 686              	.LBB85:
 201:b3ReadWavFile.h **** 	{
 202:b3ReadWavFile.h **** 		return m_numFrames;
 687              		.loc 1 202 3 view .LVU187
 688              		.loc 1 202 3 is_stmt 0 view .LVU188
 689              	.LBE85:
 690              	.LBE84:
 116:SampleLibrary.cpp ****     samples_[index].audioDataLoaded = false;  // Audio data NOT loaded yet
 691              		.loc 2 116 28 view .LVU189
 692 007a 0123     		movs	r3, #1
 114:SampleLibrary.cpp ****     samples_[index].sampleRate = (int)samples_[index].reader.getFileDataRate();
 693              		.loc 2 114 31 view .LVU190
 694 007c B96C     		ldr	r1, [r7, #72]
 120:SampleLibrary.cpp ****     samples_[index].bitsPerSample = 16;
 695              		.loc 2 120 30 view .LVU191
 696 007e 0222     		movs	r2, #2
 116:SampleLibrary.cpp ****     samples_[index].audioDataLoaded = false;  // Audio data NOT loaded yet
 697              		.loc 2 116 28 view .LVU192
 698 0080 A7F86830 		strh	r3, [r7, #104]	@ movhi
 121:SampleLibrary.cpp ****     
 699              		.loc 2 121 35 view .LVU193
 700 0084 1023     		movs	r3, #16
 114:SampleLibrary.cpp ****     samples_[index].sampleRate = (int)samples_[index].reader.getFileDataRate();
 701              		.loc 2 114 31 view .LVU194
 702 0086 3962     		str	r1, [r7, #32]
 115:SampleLibrary.cpp ****     samples_[index].loaded = true;           // Metadata is loaded
 703              		.loc 2 115 5 is_stmt 1 view .LVU195
 704              	.LVL53:
 705              	.LBB86:
 706              	.LBI86:
 203:b3ReadWavFile.h **** 	}
 204:b3ReadWavFile.h **** 	
 205:b3ReadWavFile.h **** 	double getFileDataRate()
 707              		.loc 1 205 9 view .LVU196
 708              	.LBB87:
 206:b3ReadWavFile.h **** 	{
 207:b3ReadWavFile.h **** 	  return fileDataRate_;
 709              		.loc 1 207 4 view .LVU197
 710              		.loc 1 207 4 is_stmt 0 view .LVU198
 711              	.LBE87:
 712              	.LBE86:
 120:SampleLibrary.cpp ****     samples_[index].bitsPerSample = 16;
 713              		.loc 2 120 30 view .LVU199
 714 0088 7A62     		str	r2, [r7, #36]
 121:SampleLibrary.cpp ****     
 715              		.loc 2 121 35 view .LVU200
 716 008a FB62     		str	r3, [r7, #44]
 115:SampleLibrary.cpp ****     samples_[index].loaded = true;           // Metadata is loaded
 717              		.loc 2 115 34 view .LVU201
 718 008c 97ED147B 		vldr.64	d7, [r7, #80]
 719 0090 BDEEC77B 		vcvt.s32.f64	s14, d7
 720 0094 87ED0A7A 		vstr.32	s14, [r7, #40]	@ int
 116:SampleLibrary.cpp ****     samples_[index].audioDataLoaded = false;  // Audio data NOT loaded yet
 721              		.loc 2 116 5 is_stmt 1 view .LVU202
 117:SampleLibrary.cpp ****     
 722              		.loc 2 117 5 view .LVU203
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 23


 120:SampleLibrary.cpp ****     samples_[index].bitsPerSample = 16;
 723              		.loc 2 120 5 view .LVU204
 121:SampleLibrary.cpp ****     
 724              		.loc 2 121 5 view .LVU205
 123:SampleLibrary.cpp **** }
 725              		.loc 2 123 5 view .LVU206
 123:SampleLibrary.cpp **** }
 726              		.loc 2 123 12 is_stmt 0 view .LVU207
 727 0098 BFE7     		b	.L48
 728              		.cfi_endproc
 729              	.LFE3552:
 731 009a 00BF     		.section	.rodata._ZN13SampleLibrary4initEv.str1.4,"aMS",%progbits,1
 732              		.align	2
 733              	.LC0:
 734 0000 2F00     		.ascii	"/\000"
 735 0002 0000     		.align	2
 736              	.LC1:
 737 0004 2E776176 		.ascii	".wav\000"
 737      00
 738 0009 000000   		.align	2
 739              	.LC2:
 740 000c 2E574156 		.ascii	".WAV\000"
 740      00
 741              		.section	.text._ZN13SampleLibrary4initEv,"ax",%progbits
 742              		.align	1
 743              		.p2align 2,,3
 744              		.global	_ZN13SampleLibrary4initEv
 745              		.syntax unified
 746              		.thumb
 747              		.thumb_func
 748              		.fpu fpv5-d16
 750              	_ZN13SampleLibrary4initEv:
 751              	.LVL54:
 752              	.LFB3551:
  23:SampleLibrary.cpp ****     // Mount the SD card file system
 753              		.loc 2 23 28 is_stmt 1 view -0
 754              		.cfi_startproc
 755              		@ args = 0, pretend = 0, frame = 328
 756              		@ frame_needed = 0, uses_anonymous_args = 0
  25:SampleLibrary.cpp ****     if (f_mount(&fs, "/", 1) != FR_OK) {
 757              		.loc 2 25 5 view .LVU209
  23:SampleLibrary.cpp ****     // Mount the SD card file system
 758              		.loc 2 23 28 is_stmt 0 view .LVU210
 759 0000 30B5     		push	{r4, r5, lr}
 760              		.cfi_def_cfa_offset 12
 761              		.cfi_offset 4, -12
 762              		.cfi_offset 5, -8
 763              		.cfi_offset 14, -4
  25:SampleLibrary.cpp ****     if (f_mount(&fs, "/", 1) != FR_OK) {
 764              		.loc 2 25 17 view .LVU211
 765 0002 00F58055 		add	r5, r0, #4096
  23:SampleLibrary.cpp ****     // Mount the SD card file system
 766              		.loc 2 23 28 view .LVU212
 767 0006 0446     		mov	r4, r0
 768              	.LVL55:
 769              	.LBB88:
 770              	.LBI88:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 24


 771              		.file 4 "../../libDaisy//src/sys/fatfs.h"
   1:../../libDaisy//src/sys/fatfs.h **** #ifndef __fatfs_H
   2:../../libDaisy//src/sys/fatfs.h **** #define __fatfs_H /**< & */
   3:../../libDaisy//src/sys/fatfs.h **** 
   4:../../libDaisy//src/sys/fatfs.h **** #include "ff.h"
   5:../../libDaisy//src/sys/fatfs.h **** 
   6:../../libDaisy//src/sys/fatfs.h **** namespace daisy
   7:../../libDaisy//src/sys/fatfs.h **** {
   8:../../libDaisy//src/sys/fatfs.h **** /** @brief Daisy FatFS Driver Interface
   9:../../libDaisy//src/sys/fatfs.h ****  *  @details Specifies the desired media (SD Card, USB, etc.) to be mountable with FatFS
  10:../../libDaisy//src/sys/fatfs.h ****  *           within a given application. Once initialization is called, the standard
  11:../../libDaisy//src/sys/fatfs.h ****  *           FatFS API will be usable with the media mounted in the order 
  12:../../libDaisy//src/sys/fatfs.h ****  *           they are listed in the Media config struct. 
  13:../../libDaisy//src/sys/fatfs.h ****  *           For example, when only using an SD Card, it will mount at "0:/",
  14:../../libDaisy//src/sys/fatfs.h ****  *           when only using USB, it will mount at "0:/". However, when mounting 
  15:../../libDaisy//src/sys/fatfs.h ****  *           with SD card and USB, the SD card will mount at "0:/", and the USB 
  16:../../libDaisy//src/sys/fatfs.h ****  *           will mount at "1:/".
  17:../../libDaisy//src/sys/fatfs.h ****  *           The relevant hardware peripheral (SDMMC, or MSD) needs to be initialized
  18:../../libDaisy//src/sys/fatfs.h ****  *           separately by the application before using FatFS.
  19:../../libDaisy//src/sys/fatfs.h ****  *          
  20:../../libDaisy//src/sys/fatfs.h ****  *           This object has some memory limitations due to the media connected to it.
  21:../../libDaisy//src/sys/fatfs.h ****  *           The SDMMC1 peripheral can only communicate with the AXI SRAM, and the DTCMRAM 
  22:../../libDaisy//src/sys/fatfs.h ****  *           cannot communicate with the DMA. So the FatFSInterface object should always be
  23:../../libDaisy//src/sys/fatfs.h ****  *           located in the AXI SRAM. This is the default location for all data/bss memory
  24:../../libDaisy//src/sys/fatfs.h ****  *           using the standard build. However, applciations using the electrosmith bootloader
  25:../../libDaisy//src/sys/fatfs.h ****  *           will need special consideration when using this object AND an SD Card. 
  26:../../libDaisy//src/sys/fatfs.h ****  */
  27:../../libDaisy//src/sys/fatfs.h **** class FatFSInterface
  28:../../libDaisy//src/sys/fatfs.h **** {
  29:../../libDaisy//src/sys/fatfs.h ****   public:
  30:../../libDaisy//src/sys/fatfs.h ****     /** Return values specifying specific errors for linking Daisy to FatFS */
  31:../../libDaisy//src/sys/fatfs.h ****     enum Result
  32:../../libDaisy//src/sys/fatfs.h ****     {
  33:../../libDaisy//src/sys/fatfs.h ****         OK,
  34:../../libDaisy//src/sys/fatfs.h ****         ERR_TOO_MANY_VOLUMES,
  35:../../libDaisy//src/sys/fatfs.h ****         ERR_NO_MEDIA_SELECTED,
  36:../../libDaisy//src/sys/fatfs.h ****         ERR_GENERIC,
  37:../../libDaisy//src/sys/fatfs.h ****     };
  38:../../libDaisy//src/sys/fatfs.h **** 
  39:../../libDaisy//src/sys/fatfs.h ****     /** Config structure for configuring Daisy to FatFS */
  40:../../libDaisy//src/sys/fatfs.h ****     struct Config
  41:../../libDaisy//src/sys/fatfs.h ****     {
  42:../../libDaisy//src/sys/fatfs.h ****         /** Selected Media that will be linked to FatFS 
  43:../../libDaisy//src/sys/fatfs.h ****          *  These values can be OR'd together when multiple
  44:../../libDaisy//src/sys/fatfs.h ****          *  volumes are desired 
  45:../../libDaisy//src/sys/fatfs.h ****          *  i.e. config.media = Media::SD | Media::USBH;
  46:../../libDaisy//src/sys/fatfs.h ****          * 
  47:../../libDaisy//src/sys/fatfs.h ****          *  When mounting multiple volumes, ffconf.h must have 
  48:../../libDaisy//src/sys/fatfs.h ****          *  _VOLUMES set to an appropriate value.
  49:../../libDaisy//src/sys/fatfs.h ****          * 
  50:../../libDaisy//src/sys/fatfs.h ****          *  FatFS will register multiple volumes in the order of the enum,
  51:../../libDaisy//src/sys/fatfs.h ****          *   the first registered class will mount at "0:/",
  52:../../libDaisy//src/sys/fatfs.h ****          *   the second registered class will mount at "1:/", and so on
  53:../../libDaisy//src/sys/fatfs.h ****          */
  54:../../libDaisy//src/sys/fatfs.h ****         enum Media : uint8_t
  55:../../libDaisy//src/sys/fatfs.h ****         {
  56:../../libDaisy//src/sys/fatfs.h ****             MEDIA_SD  = 0x01,
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 25


  57:../../libDaisy//src/sys/fatfs.h ****             MEDIA_USB = 0x02,
  58:../../libDaisy//src/sys/fatfs.h ****             // MEDIA_QSPI = 0x04,
  59:../../libDaisy//src/sys/fatfs.h ****         };
  60:../../libDaisy//src/sys/fatfs.h **** 
  61:../../libDaisy//src/sys/fatfs.h ****         uint8_t media;
  62:../../libDaisy//src/sys/fatfs.h ****     };
  63:../../libDaisy//src/sys/fatfs.h **** 
  64:../../libDaisy//src/sys/fatfs.h ****     FatFSInterface() {}
  65:../../libDaisy//src/sys/fatfs.h **** 
  66:../../libDaisy//src/sys/fatfs.h ****     /** Link the desired hardware specified via Config::Media */
  67:../../libDaisy//src/sys/fatfs.h ****     Result Init(const Config& cfg);
  68:../../libDaisy//src/sys/fatfs.h **** 
  69:../../libDaisy//src/sys/fatfs.h ****     /** Link the desired hardware specified via Config::Media 
  70:../../libDaisy//src/sys/fatfs.h ****      * 
  71:../../libDaisy//src/sys/fatfs.h ****      *  Alternate, explicit initialization provided for simplified syntax.
  72:../../libDaisy//src/sys/fatfs.h ****      */
  73:../../libDaisy//src/sys/fatfs.h ****     Result Init(const uint8_t media);
  74:../../libDaisy//src/sys/fatfs.h **** 
  75:../../libDaisy//src/sys/fatfs.h ****     /** Unlinks FatFS from the configured media */
  76:../../libDaisy//src/sys/fatfs.h ****     Result DeInit();
  77:../../libDaisy//src/sys/fatfs.h **** 
  78:../../libDaisy//src/sys/fatfs.h ****     bool Initialized() const { return initialized_; }
  79:../../libDaisy//src/sys/fatfs.h **** 
  80:../../libDaisy//src/sys/fatfs.h ****     /** Return the current configuration */
  81:../../libDaisy//src/sys/fatfs.h ****     const Config& GetConfig() const { return cfg_; }
  82:../../libDaisy//src/sys/fatfs.h **** 
  83:../../libDaisy//src/sys/fatfs.h ****     /** Return a mutable reference to the Configuration */
  84:../../libDaisy//src/sys/fatfs.h ****     Config& GetMutableConfig() { return cfg_; }
  85:../../libDaisy//src/sys/fatfs.h **** 
  86:../../libDaisy//src/sys/fatfs.h ****     /** Returns the path to an SD Card volume to use with f_mount */
  87:../../libDaisy//src/sys/fatfs.h ****     const char* GetSDPath() const { return path_[0]; }
  88:../../libDaisy//src/sys/fatfs.h **** 
  89:../../libDaisy//src/sys/fatfs.h ****     /** Returns the path to a USB Device volume to use with f_mount */
  90:../../libDaisy//src/sys/fatfs.h ****     const char* GetUSBPath() const { return path_[1]; }
  91:../../libDaisy//src/sys/fatfs.h **** 
  92:../../libDaisy//src/sys/fatfs.h ****     /** Returns reference to filesystem object for the SD volume. */
  93:../../libDaisy//src/sys/fatfs.h ****     FATFS& GetSDFileSystem() { return fs_[0]; }
 772              		.loc 4 93 12 is_stmt 1 view .LVU213
 773              	.LBB89:
 774              		.loc 4 93 32 view .LVU214
 775              		.loc 4 93 32 is_stmt 0 view .LVU215
 776              	.LBE89:
 777              	.LBE88:
  26:SampleLibrary.cpp ****         return false;  // Failed to mount
 778              		.loc 2 26 5 is_stmt 1 view .LVU216
  23:SampleLibrary.cpp ****     // Mount the SD card file system
 779              		.loc 2 23 28 is_stmt 0 view .LVU217
 780 0008 D3B0     		sub	sp, sp, #332
 781              		.cfi_def_cfa_offset 344
  26:SampleLibrary.cpp ****         return false;  // Failed to mount
 782              		.loc 2 26 16 view .LVU218
 783 000a 0122     		movs	r2, #1
 784              	.LBB91:
 785              	.LBB90:
 786              		.loc 4 93 44 view .LVU219
 787 000c D5F8080C 		ldr	r0, [r5, #3080]
 788              	.LVL56:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 26


 789              		.loc 4 93 44 view .LVU220
 790              	.LBE90:
 791              	.LBE91:
  26:SampleLibrary.cpp ****         return false;  // Failed to mount
 792              		.loc 2 26 16 view .LVU221
 793 0010 2049     		ldr	r1, .L75
 794 0012 0430     		adds	r0, r0, #4
 795 0014 FFF7FEFF 		bl	f_mount
 796              	.LVL57:
  26:SampleLibrary.cpp ****         return false;  // Failed to mount
 797              		.loc 2 26 5 view .LVU222
 798 0018 10B1     		cbz	r0, .L56
 799              	.L58:
  27:SampleLibrary.cpp ****     }
 800              		.loc 2 27 16 view .LVU223
 801 001a 0020     		movs	r0, #0
  75:SampleLibrary.cpp **** 
 802              		.loc 2 75 1 view .LVU224
 803 001c 53B0     		add	sp, sp, #332
 804              		.cfi_remember_state
 805              		.cfi_def_cfa_offset 12
 806              		@ sp needed
 807 001e 30BD     		pop	{r4, r5, pc}
 808              	.LVL58:
 809              	.L56:
 810              		.cfi_restore_state
  31:SampleLibrary.cpp ****     if (f_opendir(&dir, "/") != FR_OK) {
 811              		.loc 2 31 5 is_stmt 1 view .LVU225
  32:SampleLibrary.cpp ****         return false;  // Failed to open directory
 812              		.loc 2 32 5 view .LVU226
  32:SampleLibrary.cpp ****         return false;  // Failed to open directory
 813              		.loc 2 32 18 is_stmt 0 view .LVU227
 814 0020 1C49     		ldr	r1, .L75
 815 0022 6846     		mov	r0, sp
 816 0024 FFF7FEFF 		bl	f_opendir
 817              	.LVL59:
  32:SampleLibrary.cpp ****         return false;  // Failed to open directory
 818              		.loc 2 32 5 view .LVU228
 819 0028 0028     		cmp	r0, #0
 820 002a F6D1     		bne	.L58
 821              	.L59:
  37:SampleLibrary.cpp ****     FRESULT result;
 822              		.loc 2 37 5 is_stmt 1 view .LVU229
  38:SampleLibrary.cpp ****     
 823              		.loc 2 38 5 view .LVU230
  40:SampleLibrary.cpp ****         result = f_readdir(&dir, &fno);
 824              		.loc 2 40 5 view .LVU231
 825              	.LBB92:
  41:SampleLibrary.cpp ****         
 826              		.loc 2 41 9 view .LVU232
  41:SampleLibrary.cpp ****         
 827              		.loc 2 41 27 is_stmt 0 view .LVU233
 828 002c 0CA9     		add	r1, sp, #48
 829 002e 6846     		mov	r0, sp
 830 0030 FFF7FEFF 		bl	f_readdir
 831              	.LVL60:
  49:SampleLibrary.cpp ****             continue;
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 27


 832              		.loc 2 49 9 is_stmt 1 view .LVU234
  54:SampleLibrary.cpp ****         if (strstr(filename, ".wav") == nullptr && 
 833              		.loc 2 54 9 view .LVU235
  55:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
 834              		.loc 2 55 9 view .LVU236
  41:SampleLibrary.cpp ****         
 835              		.loc 2 41 27 is_stmt 0 view .LVU237
 836 0034 0346     		mov	r3, r0
 837              	.LVL61:
  44:SampleLibrary.cpp ****             break;
 838              		.loc 2 44 9 is_stmt 1 view .LVU238
  55:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
 839              		.loc 2 55 19 is_stmt 0 view .LVU239
 840 0036 1849     		ldr	r1, .L75+4
 841 0038 0DF14600 		add	r0, sp, #70
 842              	.LVL62:
  44:SampleLibrary.cpp ****             break;
 843              		.loc 2 44 9 view .LVU240
 844 003c 1BBB     		cbnz	r3, .L60
  44:SampleLibrary.cpp ****             break;
 845              		.loc 2 44 29 discriminator 1 view .LVU241
 846 003e 9DF84630 		ldrb	r3, [sp, #70]	@ zero_extendqisi2
 847              	.LVL63:
  44:SampleLibrary.cpp ****             break;
 848              		.loc 2 44 29 discriminator 1 view .LVU242
 849 0042 03B3     		cbz	r3, .L60
  49:SampleLibrary.cpp ****             continue;
 850              		.loc 2 49 9 view .LVU243
 851 0044 9DF83830 		ldrb	r3, [sp, #56]	@ zero_extendqisi2
 852 0048 13F0120F 		tst	r3, #18
 853 004c EED1     		bne	.L59
  55:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
 854              		.loc 2 55 19 view .LVU244
 855 004e FFF7FEFF 		bl	strstr
 856              	.LVL64:
  55:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
 857              		.loc 2 55 9 view .LVU245
 858 0052 80B1     		cbz	r0, .L74
 859              	.L62:
  61:SampleLibrary.cpp ****             if (loadSampleInfo(filename, sampleCount_)) {
 860              		.loc 2 61 9 is_stmt 1 view .LVU246
  62:SampleLibrary.cpp ****                 sampleCount_++;
 861              		.loc 2 62 13 view .LVU247
  61:SampleLibrary.cpp ****             if (loadSampleInfo(filename, sampleCount_)) {
 862              		.loc 2 61 13 is_stmt 0 view .LVU248
 863 0054 D5F8002C 		ldr	r2, [r5, #3072]
  62:SampleLibrary.cpp ****                 sampleCount_++;
 864              		.loc 2 62 31 view .LVU249
 865 0058 0DF14601 		add	r1, sp, #70
 866              	.LVL65:
  62:SampleLibrary.cpp ****                 sampleCount_++;
 867              		.loc 2 62 31 view .LVU250
 868 005c 2046     		mov	r0, r4
  61:SampleLibrary.cpp ****             if (loadSampleInfo(filename, sampleCount_)) {
 869              		.loc 2 61 9 view .LVU251
 870 005e 3F2A     		cmp	r2, #63
 871 0060 11DC     		bgt	.L60
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 28


 872              	.LVL66:
  62:SampleLibrary.cpp ****                 sampleCount_++;
 873              		.loc 2 62 31 view .LVU252
 874 0062 FFF7FEFF 		bl	_ZN13SampleLibrary14loadSampleInfoEPKci
 875              	.LVL67:
  63:SampleLibrary.cpp ****             }
 876              		.loc 2 63 17 is_stmt 1 view .LVU253
  62:SampleLibrary.cpp ****                 sampleCount_++;
 877              		.loc 2 62 13 is_stmt 0 view .LVU254
 878 0066 0028     		cmp	r0, #0
 879 0068 E0D0     		beq	.L59
  63:SampleLibrary.cpp ****             }
 880              		.loc 2 63 29 view .LVU255
 881 006a D5F8003C 		ldr	r3, [r5, #3072]
 882 006e 0133     		adds	r3, r3, #1
 883 0070 C5F8003C 		str	r3, [r5, #3072]
 884 0074 DAE7     		b	.L59
 885              	.L74:
  56:SampleLibrary.cpp ****             continue;  // Not a WAV file
 886              		.loc 2 56 19 discriminator 1 view .LVU256
 887 0076 0949     		ldr	r1, .L75+8
 888 0078 0DF14600 		add	r0, sp, #70
 889              	.LVL68:
  56:SampleLibrary.cpp ****             continue;  // Not a WAV file
 890              		.loc 2 56 19 discriminator 1 view .LVU257
 891 007c FFF7FEFF 		bl	strstr
 892              	.LVL69:
  55:SampleLibrary.cpp ****             strstr(filename, ".WAV") == nullptr) {
 893              		.loc 2 55 49 discriminator 1 view .LVU258
 894 0080 0028     		cmp	r0, #0
 895 0082 E7D1     		bne	.L62
 896 0084 D2E7     		b	.L59
 897              	.L60:
 898              	.LBE92:
  72:SampleLibrary.cpp ****     
 899              		.loc 2 72 5 is_stmt 1 view .LVU259
  72:SampleLibrary.cpp ****     
 900              		.loc 2 72 15 is_stmt 0 view .LVU260
 901 0086 6846     		mov	r0, sp
 902 0088 FFF7FEFF 		bl	f_closedir
 903              	.LVL70:
  74:SampleLibrary.cpp **** }
 904              		.loc 2 74 5 is_stmt 1 view .LVU261
  74:SampleLibrary.cpp **** }
 905              		.loc 2 74 12 is_stmt 0 view .LVU262
 906 008c 0120     		movs	r0, #1
  75:SampleLibrary.cpp **** 
 907              		.loc 2 75 1 view .LVU263
 908 008e 53B0     		add	sp, sp, #332
 909              		.cfi_def_cfa_offset 12
 910              		@ sp needed
 911 0090 30BD     		pop	{r4, r5, pc}
 912              	.LVL71:
 913              	.L76:
  75:SampleLibrary.cpp **** 
 914              		.loc 2 75 1 view .LVU264
 915 0092 00BF     		.align	2
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 29


 916              	.L75:
 917 0094 00000000 		.word	.LC0
 918 0098 04000000 		.word	.LC1
 919 009c 0C000000 		.word	.LC2
 920              		.cfi_endproc
 921              	.LFE3551:
 923              		.section	.text._ZN13SampleLibrary14loadSampleDataEi,"ax",%progbits
 924              		.align	1
 925              		.p2align 2,,3
 926              		.global	_ZN13SampleLibrary14loadSampleDataEi
 927              		.syntax unified
 928              		.thumb
 929              		.thumb_func
 930              		.fpu fpv5-d16
 932              	_ZN13SampleLibrary14loadSampleDataEi:
 933              	.LVL72:
 934              	.LFB3555:
 126:SampleLibrary.cpp ****     // Check if already loaded
 935              		.loc 2 126 47 is_stmt 1 view -0
 936              		.cfi_startproc
 937              		@ args = 0, pretend = 0, frame = 0
 938              		@ frame_needed = 0, uses_anonymous_args = 0
 939              		@ link register save eliminated.
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 940              		.loc 2 128 5 view .LVU266
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 941              		.loc 2 128 25 is_stmt 0 view .LVU267
 942 0000 C1EBC103 		rsb	r3, r1, r1, lsl #3
 943 0004 00EB0313 		add	r3, r0, r3, lsl #4
 944 0008 93F86930 		ldrb	r3, [r3, #105]	@ zero_extendqisi2
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 945              		.loc 2 128 5 view .LVU268
 946 000c 0BB1     		cbz	r3, .L79
 947              		.loc 2 170 1 view .LVU269
 948 000e 1846     		mov	r0, r3
 949              	.LVL73:
 950              		.loc 2 170 1 view .LVU270
 951 0010 7047     		bx	lr
 952              	.LVL74:
 953              	.L79:
 954              		.loc 2 170 1 view .LVU271
 955 0012 FFF7FEBF 		b	_ZN13SampleLibrary14loadSampleDataEi.part.0
 956              	.LVL75:
 957              		.loc 2 170 1 view .LVU272
 958              		.cfi_endproc
 959              	.LFE3555:
 961 0016 00BF     		.section	.text._ZN13SampleLibrary9getSampleEi,"ax",%progbits
 962              		.align	1
 963              		.p2align 2,,3
 964              		.global	_ZN13SampleLibrary9getSampleEi
 965              		.syntax unified
 966              		.thumb
 967              		.thumb_func
 968              		.fpu fpv5-d16
 970              	_ZN13SampleLibrary9getSampleEi:
 971              	.LVL76:
 972              	.LFB3556:
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 30


 171:SampleLibrary.cpp **** 
 172:SampleLibrary.cpp **** SampleInfo* SampleLibrary::getSample(int index) {
 973              		.loc 2 172 49 is_stmt 1 view -0
 974              		.cfi_startproc
 975              		@ args = 0, pretend = 0, frame = 0
 976              		@ frame_needed = 0, uses_anonymous_args = 0
 977              		@ link register save eliminated.
 173:SampleLibrary.cpp ****     if (index >= 0 && index < sampleCount_) {
 978              		.loc 2 173 5 view .LVU274
 979 0000 0029     		cmp	r1, #0
 980              		.loc 2 173 5 is_stmt 0 view .LVU275
 981 0002 0ADB     		blt	.L83
 982              		.loc 2 173 31 discriminator 1 view .LVU276
 983 0004 00F58053 		add	r3, r0, #4096
 984              		.loc 2 173 20 discriminator 1 view .LVU277
 985 0008 D3F8003C 		ldr	r3, [r3, #3072]
 986 000c 8B42     		cmp	r3, r1
 987 000e 04DD     		ble	.L83
 174:SampleLibrary.cpp ****         return &samples_[index];
 988              		.loc 2 174 9 is_stmt 1 view .LVU278
 989              		.loc 2 174 31 is_stmt 0 view .LVU279
 990 0010 C1EBC101 		rsb	r1, r1, r1, lsl #3
 991              	.LVL77:
 992              		.loc 2 174 31 view .LVU280
 993 0014 00EB0110 		add	r0, r0, r1, lsl #4
 994              	.LVL78:
 995              		.loc 2 174 31 view .LVU281
 996 0018 7047     		bx	lr
 997              	.LVL79:
 998              	.L83:
 175:SampleLibrary.cpp ****     }
 176:SampleLibrary.cpp ****     return nullptr;
 999              		.loc 2 176 12 view .LVU282
 1000 001a 0020     		movs	r0, #0
 1001              	.LVL80:
 177:SampleLibrary.cpp **** }
 1002              		.loc 2 177 1 view .LVU283
 1003 001c 7047     		bx	lr
 1004              		.cfi_endproc
 1005              	.LFE3556:
 1007 001e 00BF     		.section	.text._ZN13SampleLibrary18ensureSampleLoadedEi,"ax",%progbits
 1008              		.align	1
 1009              		.p2align 2,,3
 1010              		.global	_ZN13SampleLibrary18ensureSampleLoadedEi
 1011              		.syntax unified
 1012              		.thumb
 1013              		.thumb_func
 1014              		.fpu fpv5-d16
 1016              	_ZN13SampleLibrary18ensureSampleLoadedEi:
 1017              	.LVL81:
 1018              	.LFB3557:
 178:SampleLibrary.cpp **** 
 179:SampleLibrary.cpp **** bool SampleLibrary::ensureSampleLoaded(int index) {
 1019              		.loc 2 179 51 is_stmt 1 view -0
 1020              		.cfi_startproc
 1021              		@ args = 0, pretend = 0, frame = 0
 1022              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 31


 1023              		@ link register save eliminated.
 180:SampleLibrary.cpp ****     if (index < 0 || index >= sampleCount_) {
 1024              		.loc 2 180 5 view .LVU285
 1025 0000 0B1E     		subs	r3, r1, #0
 1026 0002 17DB     		blt	.L86
 179:SampleLibrary.cpp ****     if (index < 0 || index >= sampleCount_) {
 1027              		.loc 2 179 51 is_stmt 0 discriminator 1 view .LVU286
 1028 0004 10B4     		push	{r4}
 1029              		.cfi_def_cfa_offset 4
 1030              		.cfi_offset 4, -4
 1031              		.loc 2 180 31 discriminator 1 view .LVU287
 1032 0006 00F58054 		add	r4, r0, #4096
 1033              		.loc 2 180 19 discriminator 1 view .LVU288
 1034 000a D4F8004C 		ldr	r4, [r4, #3072]
 1035 000e 9C42     		cmp	r4, r3
 1036 0010 04DC     		bgt	.L92
 181:SampleLibrary.cpp ****         return false;  // Invalid index
 1037              		.loc 2 181 16 view .LVU289
 1038 0012 0023     		movs	r3, #0
 1039              	.L85:
 182:SampleLibrary.cpp ****     }
 183:SampleLibrary.cpp ****     return loadSampleData(index);
 184:SampleLibrary.cpp **** }
 1040              		.loc 2 184 1 view .LVU290
 1041 0014 1846     		mov	r0, r3
 1042              	.LVL82:
 1043              		.loc 2 184 1 view .LVU291
 1044 0016 5DF8044B 		ldr	r4, [sp], #4
 1045              		.cfi_remember_state
 1046              		.cfi_restore 4
 1047              		.cfi_def_cfa_offset 0
 1048 001a 7047     		bx	lr
 1049              	.LVL83:
 1050              	.L92:
 1051              		.cfi_restore_state
 183:SampleLibrary.cpp **** }
 1052              		.loc 2 183 5 is_stmt 1 view .LVU292
 1053              	.LBB99:
 1054              	.LBI99:
 126:SampleLibrary.cpp ****     // Check if already loaded
 1055              		.loc 2 126 6 view .LVU293
 1056              	.LBB100:
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 1057              		.loc 2 128 5 view .LVU294
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 1058              		.loc 2 128 25 is_stmt 0 view .LVU295
 1059 001c C3EBC303 		rsb	r3, r3, r3, lsl #3
 1060 0020 00EB0313 		add	r3, r0, r3, lsl #4
 1061 0024 93F86930 		ldrb	r3, [r3, #105]	@ zero_extendqisi2
 128:SampleLibrary.cpp ****         return true;  // Already loaded
 1062              		.loc 2 128 5 view .LVU296
 1063 0028 002B     		cmp	r3, #0
 1064 002a F3D1     		bne	.L85
 1065              	.LBE100:
 1066              	.LBE99:
 1067              		.loc 2 184 1 view .LVU297
 1068 002c 5DF8044B 		ldr	r4, [sp], #4
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 32


 1069              		.cfi_restore 4
 1070              		.cfi_def_cfa_offset 0
 1071              	.LBB102:
 1072              	.LBB101:
 1073 0030 FFF7FEBF 		b	_ZN13SampleLibrary14loadSampleDataEi.part.0
 1074              	.LVL84:
 1075              	.L86:
 1076              		.loc 2 184 1 view .LVU298
 1077              	.LBE101:
 1078              	.LBE102:
 181:SampleLibrary.cpp ****     }
 1079              		.loc 2 181 16 view .LVU299
 1080 0034 0023     		movs	r3, #0
 1081              		.loc 2 184 1 view .LVU300
 1082 0036 1846     		mov	r0, r3
 1083              	.LVL85:
 1084              		.loc 2 184 1 view .LVU301
 1085 0038 7047     		bx	lr
 1086              		.cfi_endproc
 1087              	.LFE3557:
 1089 003a 00BF     		.section	.text._ZN13SampleLibrary10findSampleEPKc,"ax",%progbits
 1090              		.align	1
 1091              		.p2align 2,,3
 1092              		.global	_ZN13SampleLibrary10findSampleEPKc
 1093              		.syntax unified
 1094              		.thumb
 1095              		.thumb_func
 1096              		.fpu fpv5-d16
 1098              	_ZN13SampleLibrary10findSampleEPKc:
 1099              	.LVL86:
 1100              	.LFB3558:
 185:SampleLibrary.cpp **** 
 186:SampleLibrary.cpp **** int SampleLibrary::findSample(const char* name) {
 1101              		.loc 2 186 49 is_stmt 1 view -0
 1102              		.cfi_startproc
 1103              		@ args = 0, pretend = 0, frame = 0
 1104              		@ frame_needed = 0, uses_anonymous_args = 0
 187:SampleLibrary.cpp ****     for (int i = 0; i < sampleCount_; i++) {
 1105              		.loc 2 187 5 view .LVU303
 1106              	.LBB103:
 1107              		.loc 2 187 23 view .LVU304
 1108              	.LBE103:
 186:SampleLibrary.cpp ****     for (int i = 0; i < sampleCount_; i++) {
 1109              		.loc 2 186 49 is_stmt 0 view .LVU305
 1110 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1111              		.cfi_def_cfa_offset 24
 1112              		.cfi_offset 3, -24
 1113              		.cfi_offset 4, -20
 1114              		.cfi_offset 5, -16
 1115              		.cfi_offset 6, -12
 1116              		.cfi_offset 7, -8
 1117              		.cfi_offset 14, -4
 1118              	.LBB104:
 1119              		.loc 2 187 25 view .LVU306
 1120 0002 00F58053 		add	r3, r0, #4096
 1121 0006 D3F8007C 		ldr	r7, [r3, #3072]
 1122              		.loc 2 187 23 view .LVU307
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 33


 1123 000a 002F     		cmp	r7, #0
 1124 000c 0FDD     		ble	.L96
 1125 000e 0E46     		mov	r6, r1
 1126 0010 0446     		mov	r4, r0
 1127              		.loc 2 187 14 view .LVU308
 1128 0012 0025     		movs	r5, #0
 1129 0014 02E0     		b	.L95
 1130              	.LVL87:
 1131              	.L102:
 1132              		.loc 2 187 5 discriminator 2 view .LVU309
 1133 0016 0135     		adds	r5, r5, #1
 1134              	.LVL88:
 1135              		.loc 2 187 23 is_stmt 1 discriminator 2 view .LVU310
 1136 0018 BD42     		cmp	r5, r7
 1137 001a 08D0     		beq	.L96
 1138              	.LVL89:
 1139              	.L95:
 188:SampleLibrary.cpp ****         if (strcmp(samples_[i].name, name) == 0) {
 1140              		.loc 2 188 9 view .LVU311
 1141              		.loc 2 188 19 is_stmt 0 view .LVU312
 1142 001c 2046     		mov	r0, r4
 1143 001e 3146     		mov	r1, r6
 187:SampleLibrary.cpp ****     for (int i = 0; i < sampleCount_; i++) {
 1144              		.loc 2 187 23 view .LVU313
 1145 0020 7034     		adds	r4, r4, #112
 1146              		.loc 2 188 19 view .LVU314
 1147 0022 FFF7FEFF 		bl	strcmp
 1148              	.LVL90:
 187:SampleLibrary.cpp ****     for (int i = 0; i < sampleCount_; i++) {
 1149              		.loc 2 187 5 is_stmt 1 view .LVU315
 1150              		.loc 2 188 9 is_stmt 0 view .LVU316
 1151 0026 0028     		cmp	r0, #0
 1152 0028 F5D1     		bne	.L102
 1153              	.LBE104:
 189:SampleLibrary.cpp ****             return i;  // Found it!
 190:SampleLibrary.cpp ****         }
 191:SampleLibrary.cpp ****     }
 192:SampleLibrary.cpp ****     return -1;  // Not found
 193:SampleLibrary.cpp **** }
 1154              		.loc 2 193 1 view .LVU317
 1155 002a 2846     		mov	r0, r5
 1156 002c F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1157              	.LVL91:
 1158              	.L96:
 192:SampleLibrary.cpp **** }
 1159              		.loc 2 192 13 view .LVU318
 1160 002e 4FF0FF35 		mov	r5, #-1
 1161              		.loc 2 193 1 view .LVU319
 1162 0032 2846     		mov	r0, r5
 1163 0034 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1164              		.cfi_endproc
 1165              	.LFE3558:
 1167              		.weak	_ZTV16MemoryDataSource
 1168 0036 00BF     		.section	.rodata._ZTV16MemoryDataSource,"aG",%progbits,_ZTV16MemoryDataSource,comdat
 1169              		.align	2
 1172              	_ZTV16MemoryDataSource:
 1173 0000 00000000 		.word	0
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 34


 1174 0004 00000000 		.word	0
 1175 0008 00000000 		.word	_ZN16MemoryDataSource5ftellEv
 1176 000c 00000000 		.word	_ZN16MemoryDataSource5freadEPvjj
 1177 0010 00000000 		.word	_ZN16MemoryDataSource5fseekEli
 1178              		.text
 1179              	.Letext0:
 1180              		.file 5 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\machine\\_default_types.h"
 1181              		.file 6 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\sys\\_stdint.h"
 1182              		.file 7 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\stdint.h"
 1183              		.file 8 "c:\\program files\\daisytoolchain\\lib\\gcc\\arm-none-eabi\\10.2.1\\include\\stddef.h"
 1184              		.file 9 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cmath"
 1185              		.file 10 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\std_abs.h"
 1186              		.file 11 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\type_traits"
 1187              		.file 12 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\debug\\debug.h"
 1188              		.file 13 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\stl_pair.h
 1189              		.file 14 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\exception_
 1190              		.file 15 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\arm-none-eabi\\t
 1191              		.file 16 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cstdlib"
 1192              		.file 17 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cstdint"
 1193              		.file 18 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\algorithmf
 1194              		.file 19 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cstdarg"
 1195              		.file 20 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cstdio"
 1196              		.file 21 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cstring"
 1197              		.file 22 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\cwchar"
 1198              		.file 23 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\clocale"
 1199              		.file 24 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\basic_stri
 1200              		.file 25 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\bits\\predefined
 1201              		.file 26 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\sys\\_types.h"
 1202              		.file 27 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\sys\\reent.h"
 1203              		.file 28 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\sys\\lock.h"
 1204              		.file 29 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\math.h"
 1205              		.file 30 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\stdlib.h"
 1206              		.file 31 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\math.h"
 1207              		.file 32 "c:\\program files\\daisytoolchain\\lib\\gcc\\arm-none-eabi\\10.2.1\\include\\stdarg.h"
 1208              		.file 33 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\stdio.h"
 1209              		.file 34 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\c++\\10.2.1\\stdlib.h"
 1210              		.file 35 "../../libDaisy//src/daisy_core.h"
 1211              		.file 36 "../../libDaisy//src/per/sdmmc.h"
 1212              		.file 37 "../../libDaisy//src/util/wav_format.h"
 1213              		.file 38 "../../libDaisy//src/dev/max11300.h"
 1214              		.file 39 "../../libDaisy//src/daisy_seed.h"
 1215              		.file 40 "../../libDaisy//Middlewares/Third_Party/FatFs/src/integer.h"
 1216              		.file 41 "../../libDaisy//Middlewares/Third_Party/FatFs/src/ff.h"
 1217              		.file 42 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\string.h"
 1218              		.file 43 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\wchar.h"
 1219              		.file 44 "c:\\program files\\daisytoolchain\\arm-none-eabi\\include\\locale.h"
 1220              		.file 45 "../../libDaisy//src/dev/sr_595.h"
 1221              		.file 46 "<built-in>"
ARM GAS  C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s 			page 35


DEFINED SYMBOLS
                            *ABS*:00000000 SampleLibrary.cpp
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:17     .text._ZN16MemoryDataSource5ftellEv:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:26     .text._ZN16MemoryDataSource5ftellEv:00000000 _ZN16MemoryDataSource5ftellEv
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:45     .text._ZN16MemoryDataSource5freadEPvjj:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:53     .text._ZN16MemoryDataSource5freadEPvjj:00000000 _ZN16MemoryDataSource5freadEPvjj
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:159    .text._ZN16MemoryDataSource5fseekEli:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:167    .text._ZN16MemoryDataSource5fseekEli:00000000 _ZN16MemoryDataSource5fseekEli
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:232    .text._ZN13SampleLibrary14loadSampleDataEi.part.0:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:239    .text._ZN13SampleLibrary14loadSampleDataEi.part.0:00000000 _ZN13SampleLibrary14loadSampleDataEi.part.0
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:390    .text._ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:398    .text._ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE:00000000 _ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:521    .text._ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE:00000058 $d
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1172   .rodata._ZTV16MemoryDataSource:00000000 _ZTV16MemoryDataSource
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:398    .text._ZN13SampleLibraryC2ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE:00000000 _ZN13SampleLibraryC1ERN5daisy12SdmmcHandlerERNS0_14FatFSInterfaceE
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:528    .text._ZN13SampleLibrary14loadSampleInfoEPKci:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:536    .text._ZN13SampleLibrary14loadSampleInfoEPKci:00000000 _ZN13SampleLibrary14loadSampleInfoEPKci
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:732    .rodata._ZN13SampleLibrary4initEv.str1.4:00000000 $d
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:742    .text._ZN13SampleLibrary4initEv:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:750    .text._ZN13SampleLibrary4initEv:00000000 _ZN13SampleLibrary4initEv
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:917    .text._ZN13SampleLibrary4initEv:00000094 $d
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:924    .text._ZN13SampleLibrary14loadSampleDataEi:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:932    .text._ZN13SampleLibrary14loadSampleDataEi:00000000 _ZN13SampleLibrary14loadSampleDataEi
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:962    .text._ZN13SampleLibrary9getSampleEi:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:970    .text._ZN13SampleLibrary9getSampleEi:00000000 _ZN13SampleLibrary9getSampleEi
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1008   .text._ZN13SampleLibrary18ensureSampleLoadedEi:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1016   .text._ZN13SampleLibrary18ensureSampleLoadedEi:00000000 _ZN13SampleLibrary18ensureSampleLoadedEi
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1090   .text._ZN13SampleLibrary10findSampleEPKc:00000000 $t
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1098   .text._ZN13SampleLibrary10findSampleEPKc:00000000 _ZN13SampleLibrary10findSampleEPKc
C:\Users\halcyon\AppData\Local\Temp\ccjdAwZq.s:1169   .rodata._ZTV16MemoryDataSource:00000000 $d

UNDEFINED SYMBOLS
f_open
_Z20custom_pool_allocatej
f_read
f_close
_ZN13b3ReadWavFile10getWavInfoER12b3DataSource
_ZN13b3ReadWavFileC1Ev
strncpy
f_mount
f_opendir
f_readdir
strstr
f_closedir
strcmp
